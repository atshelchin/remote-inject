/**
 * Auto-generated embedded assets
 * DO NOT EDIT - Generated by scripts/embed-assets.ts
 */

export interface EmbeddedAsset {
  content: string
  mimeType: string
  isBase64: boolean
}

// Check if running as compiled executable
// Multiple detection methods for reliability across platforms
export const IS_COMPILED = (() => {
  if (typeof Bun === 'undefined') return false

  // Method 1: Check if Bun.main starts with bunfs paths (Bun's virtual filesystem)
  const main = Bun.main || ''
  if (main.startsWith('/$bunfs/') || main.startsWith('$bunfs/')) return true

  // Method 2: Check import.meta.path for bunfs
  const metaPath = import.meta.path || ''
  if (metaPath.includes('/$bunfs/') || metaPath.includes('$bunfs/')) return true

  // Method 3: Check if main script is a file (dev mode) vs embedded
  // In dev mode, Bun.main points to .ts/.js file; in compiled mode it doesn't
  const isScript = main.endsWith('.ts') || main.endsWith('.js')
  if (!isScript && main.length > 0) return true

  return false
})()

const assets: Record<string, EmbeddedAsset> = {
  "/public/css/theme.css": {
    content: "/**\n * Remote Inject - Theme Variables\n * Warm earthy color palette with terracotta accents\n */\n\n:root {\n  /* Light theme (default) */\n  --color-bg-primary: #faf9f7;\n  --color-bg-secondary: #ffffff;\n  --color-bg-tertiary: #f3f2ef;\n  --color-bg-overlay: rgba(0, 0, 0, 0.4);\n\n  --color-text-primary: #1c1c1a;\n  --color-text-secondary: #52524e;\n  --color-text-tertiary: #787873;\n  --color-text-muted: #a3a39d;\n\n  --color-accent: #c45a2c;\n  --color-accent-hover: #d4683a;\n  --color-accent-active: #a84d26;\n  --color-accent-muted: rgba(196, 90, 44, 0.1);\n  --color-accent-gradient: linear-gradient(135deg, #c45a2c 0%, #d97b4a 50%, #6b8a9a 100%);\n\n  --color-success: #4a8c5c;\n  --color-success-bg: rgba(74, 140, 92, 0.12);\n  --color-warning: #b8860b;\n  --color-warning-bg: rgba(184, 134, 11, 0.12);\n  --color-error: #c04040;\n  --color-error-bg: rgba(192, 64, 64, 0.12);\n  --color-info: #5a7a8a;\n  --color-info-bg: rgba(90, 122, 138, 0.12);\n\n  --color-border: rgba(0, 0, 0, 0.08);\n  --color-border-strong: rgba(0, 0, 0, 0.15);\n  --color-border-hover: rgba(174, 86, 48, 0.3);\n\n  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.03);\n  --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.035);\n  --shadow-elevated: 0 8px 30px rgba(0, 0, 0, 0.08);\n  --shadow-xl: 0 16px 50px rgba(0, 0, 0, 0.12);\n\n  --radius-sm: 4px;\n  --radius-md: 8px;\n  --radius-lg: 12px;\n  --radius-xl: 16px;\n  --radius-2xl: 24px;\n  --radius-full: 9999px;\n\n  --font-sans: 'Inter', 'Noto Sans SC', system-ui, sans-serif;\n  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;\n\n  --motion-fast: 150ms;\n  --motion-normal: 250ms;\n  --easing: cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n[data-theme=\"dark\"] {\n  /* Dark theme */\n  --color-bg-primary: #121210;\n  --color-bg-secondary: #1c1c1a;\n  --color-bg-tertiary: #242422;\n  --color-bg-overlay: rgba(0, 0, 0, 0.7);\n\n  --color-text-primary: #f5f5f2;\n  --color-text-secondary: #c0c0b8;\n  --color-text-tertiary: #8a8a82;\n  --color-text-muted: #5a5a55;\n\n  --color-accent: #e07040;\n  --color-accent-hover: #f08050;\n  --color-accent-active: #d06030;\n  --color-accent-muted: rgba(224, 112, 64, 0.12);\n  --color-accent-gradient: linear-gradient(135deg, #e07040 0%, #f09060 50%, #8aaaba 100%);\n\n  --color-success: #5ca86c;\n  --color-success-bg: rgba(92, 168, 108, 0.15);\n  --color-warning: #d4a020;\n  --color-warning-bg: rgba(212, 160, 32, 0.15);\n  --color-error: #d85050;\n  --color-error-bg: rgba(216, 80, 80, 0.15);\n  --color-info: #7a9aaa;\n  --color-info-bg: rgba(122, 154, 170, 0.15);\n\n  --color-border: rgba(255, 255, 255, 0.08);\n  --color-border-strong: rgba(255, 255, 255, 0.15);\n  --color-border-hover: rgba(212, 114, 74, 0.4);\n\n  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);\n  --shadow-card: 0 2px 12px rgba(0, 0, 0, 0.4);\n  --shadow-elevated: 0 4px 20px rgba(0, 0, 0, 0.5);\n  --shadow-xl: 0 8px 32px rgba(0, 0, 0, 0.6);\n}\n\n/* Base styles using CSS variables */\nbody {\n  font-family: var(--font-sans);\n  background: var(--color-bg-primary);\n  color: var(--color-text-primary);\n  transition: background-color var(--motion-normal) var(--easing),\n              color var(--motion-normal) var(--easing);\n}\n\n/* Common card styles */\n.card, .container {\n  background: var(--color-bg-secondary);\n  box-shadow: var(--shadow-card);\n  border: 1px solid var(--color-border);\n}\n\n/* Status colors */\n.status-success {\n  background: var(--color-success-bg);\n  color: var(--color-success);\n}\n\n.status-warning, .status-checking {\n  background: var(--color-warning-bg);\n  color: var(--color-warning);\n}\n\n.status-error {\n  background: var(--color-error-bg);\n  color: var(--color-error);\n}\n\n.status-info {\n  background: var(--color-info-bg);\n  color: var(--color-info);\n}\n\n/* Link colors */\na {\n  color: var(--color-accent);\n  transition: color var(--motion-fast) var(--easing);\n}\n\na:hover {\n  color: var(--color-accent-hover);\n}\n\n/* Button base */\n.btn {\n  font-family: var(--font-sans);\n  transition: all var(--motion-fast) var(--easing);\n}\n\n.btn-primary {\n  background: var(--color-accent);\n  color: white;\n}\n\n.btn-primary:hover {\n  background: var(--color-accent-hover);\n}\n\n.btn-primary:active {\n  background: var(--color-accent-active);\n}\n\n/* Info sections */\n.info-section, .wallet-info, .guide {\n  background: var(--color-bg-tertiary);\n}\n\n/* Border colors */\n.bordered {\n  border-color: var(--color-border);\n}\n\n/* Monospace text */\ncode, pre, .mono {\n  font-family: var(--font-mono);\n}\n\n/* Theme toggle button (optional) */\n.theme-toggle {\n  position: fixed;\n  top: 16px;\n  right: 16px;\n  width: 40px;\n  height: 40px;\n  border-radius: var(--radius-full);\n  border: 1px solid var(--color-border);\n  background: var(--color-bg-secondary);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 20px;\n  z-index: 1000;\n  transition: all var(--motion-fast) var(--easing);\n}\n\n.theme-toggle:hover {\n  background: var(--color-accent);\n  color: white;\n  border-color: var(--color-accent);\n}\n\n/* Language selector (optional) */\n.lang-selector {\n  position: fixed;\n  top: 16px;\n  right: 64px;\n  padding: 8px 12px;\n  border-radius: var(--radius-full);\n  border: 1px solid var(--color-border);\n  background: var(--color-bg-secondary);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  font-size: 14px;\n  z-index: 1000;\n  transition: all var(--motion-fast) var(--easing);\n}\n\n.lang-selector:hover {\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n}\n",
    mimeType: "text/css",
    isBase64: false,
  },
  "/public/css/base.css": {
    content: "/**\n * Remote Inject - Base Styles\n * Shared styles across all pages\n * Import after theme.css\n */\n\n/* ============ Reset ============ */\n*, *::before, *::after {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\n/* ============ Base Body ============ */\nbody {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  background: var(--color-bg-primary);\n  color: var(--color-text-primary);\n  line-height: 1.6;\n}\n\n/* ============ Utility Classes ============ */\n.hidden {\n  display: none !important;\n}\n\n.text-center {\n  text-align: center;\n}\n\n.text-left {\n  text-align: left;\n}\n\n/* ============ Loading Spinner ============ */\n.spinner {\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  border: 2px solid var(--color-accent);\n  border-radius: 50%;\n  border-top-color: transparent;\n  animation: spin 1s linear infinite;\n  margin-right: 8px;\n  vertical-align: middle;\n}\n\n.loading-ring {\n  width: 56px;\n  height: 56px;\n  border: 3px solid var(--color-border);\n  border-top-color: var(--color-accent);\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n/* ============ Pulse Animation ============ */\n.pulse-ring {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 56px;\n  height: 56px;\n  border: 2px solid var(--color-warning);\n  border-radius: 50%;\n  animation: pulse 1.5s ease-out infinite;\n}\n\n@keyframes pulse {\n  0% { transform: scale(1); opacity: 1; }\n  100% { transform: scale(1.3); opacity: 0; }\n}\n\n/* ============ Status Badges ============ */\n.status {\n  padding: 12px 16px;\n  border-radius: var(--radius-md);\n  font-size: 14px;\n}\n\n.status.checking {\n  background: var(--color-warning-bg);\n  color: var(--color-warning);\n}\n\n.status.success {\n  background: var(--color-success-bg);\n  color: var(--color-success);\n}\n\n.status.error {\n  background: var(--color-error-bg);\n  color: var(--color-error);\n}\n\n/* ============ Buttons ============ */\n.btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 12px 24px;\n  border: none;\n  border-radius: var(--radius-md);\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  text-decoration: none;\n}\n\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.btn-primary {\n  background: var(--color-accent);\n  color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n  background: var(--color-accent-hover);\n}\n\n.btn-secondary {\n  background: var(--color-bg-tertiary);\n  color: var(--color-text-primary);\n}\n\n.btn-secondary:hover:not(:disabled) {\n  filter: brightness(0.95);\n}\n\n.btn-ghost {\n  background: transparent;\n  color: var(--color-text-secondary);\n  border: 1px solid var(--color-border);\n}\n\n.btn-ghost:hover:not(:disabled) {\n  border-color: var(--color-text-secondary);\n  color: var(--color-text-primary);\n}\n\n.btn-danger {\n  background: var(--color-error);\n  color: white;\n}\n\n.btn-danger:hover:not(:disabled) {\n  filter: brightness(0.9);\n}\n\n.btn-disconnect {\n  background: var(--color-error-bg);\n  color: var(--color-error);\n}\n\n.btn-disconnect:hover:not(:disabled) {\n  filter: brightness(0.95);\n}\n\n/* ============ Form Controls ============ */\n.form-input {\n  width: 100%;\n  padding: 12px 16px;\n  font-size: 14px;\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-md);\n  background: var(--color-bg-secondary);\n  color: var(--color-text-primary);\n  outline: none;\n  transition: border-color 0.2s;\n}\n\n.form-input:focus {\n  border-color: var(--color-accent);\n}\n\n.form-input::placeholder {\n  color: var(--color-text-muted);\n}\n\n/* ============ Top Controls (Theme/Lang) ============ */\n.top-controls {\n  position: fixed;\n  top: 16px;\n  right: 16px;\n  z-index: 1000;\n  display: flex;\n  gap: 8px;\n}\n\n.ctrl-btn {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  border: 1px solid var(--color-border);\n  background: var(--color-bg-secondary);\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 16px;\n  box-shadow: var(--shadow-sm);\n  transition: all 0.2s;\n}\n\n.ctrl-btn:hover {\n  border-color: var(--color-accent);\n  color: var(--color-accent);\n}\n\nselect.ctrl-btn.lang {\n  width: auto;\n  padding: 0 12px;\n  padding-right: 24px;\n  border-radius: 20px;\n  font-size: 12px;\n  font-weight: 500;\n  appearance: none;\n  -webkit-appearance: none;\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\n  background-repeat: no-repeat;\n  background-position: right 8px center;\n}\n\nselect.ctrl-btn.lang option {\n  background: var(--color-bg-secondary);\n  color: var(--color-text-primary);\n}\n\n/* ============ DApp Info Card ============ */\n.dapp-info {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding-bottom: 16px;\n  border-bottom: 1px solid var(--color-border);\n  margin-bottom: 16px;\n}\n\n.dapp-icon {\n  width: 48px;\n  height: 48px;\n  border-radius: var(--radius-md);\n  background: var(--color-bg-tertiary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 20px;\n  overflow: hidden;\n  color: var(--color-text-secondary);\n  flex-shrink: 0;\n}\n\n.dapp-icon img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.dapp-text {\n  text-align: left;\n  min-width: 0;\n}\n\n.dapp-name {\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--color-text-primary);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.dapp-url {\n  font-size: 13px;\n  color: var(--color-accent);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* ============ Wallet Info ============ */\n.wallet-info {\n  background: var(--color-bg-tertiary);\n  border-radius: var(--radius-md);\n  padding: 12px;\n}\n\n.wallet-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 13px;\n}\n\n.wallet-row + .wallet-row {\n  margin-top: 6px;\n  padding-top: 6px;\n  border-top: 1px solid var(--color-border);\n}\n\n.wallet-label {\n  color: var(--color-text-muted);\n}\n\n.wallet-value {\n  color: var(--color-text-primary);\n  font-weight: 500;\n  font-family: monospace;\n  font-size: 12px;\n}\n\n/* ============ Guide Box ============ */\n.guide {\n  background: var(--color-bg-tertiary);\n  border-radius: var(--radius-md);\n  padding: 16px;\n  text-align: left;\n}\n\n.guide h3 {\n  font-size: 14px;\n  color: var(--color-text-primary);\n  margin-bottom: 12px;\n}\n\n.guide ol {\n  padding-left: 18px;\n  color: var(--color-text-secondary);\n  font-size: 13px;\n  line-height: 1.7;\n}\n\n.guide li {\n  margin-bottom: 4px;\n}\n\n/* ============ Brand Footer ============ */\n.brand-footer {\n  position: fixed;\n  bottom: 12px;\n  left: 0;\n  right: 0;\n  text-align: center;\n}\n\n.brand-footer a {\n  color: var(--color-text-muted);\n  font-size: 11px;\n  text-decoration: none;\n  opacity: 0.5;\n  transition: opacity 0.2s;\n}\n\n.brand-footer a:hover {\n  opacity: 0.8;\n}\n\n/* ============ Error Container ============ */\n.error-container {\n  padding: 40px 20px;\n  text-align: center;\n}\n\n.error-icon {\n  font-size: 48px;\n  margin-bottom: 16px;\n}\n\n.error-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--color-error);\n  margin-bottom: 8px;\n}\n\n.error-desc {\n  font-size: 14px;\n  color: var(--color-text-secondary);\n}\n\n/* ============ Code Block ============ */\n.code-block {\n  background: var(--color-bg-secondary);\n  border: 1px solid var(--color-border);\n  border-radius: var(--radius-lg);\n  overflow: hidden;\n}\n\n.code-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 16px;\n  background: var(--color-bg-tertiary);\n  border-bottom: 1px solid var(--color-border);\n}\n\n.code-header span {\n  font-size: 12px;\n  color: var(--color-text-muted);\n  font-weight: 500;\n}\n\n.code-copy {\n  padding: 4px 10px;\n  font-size: 11px;\n  background: transparent;\n  border: 1px solid var(--color-border);\n  border-radius: 4px;\n  color: var(--color-text-secondary);\n  cursor: pointer;\n  transition: all 0.15s;\n}\n\n.code-copy:hover {\n  background: var(--color-accent);\n  border-color: var(--color-accent);\n  color: white;\n}\n\npre {\n  padding: 20px;\n  overflow-x: auto;\n  font-family: 'SF Mono', Monaco, Consolas, monospace;\n  font-size: 13px;\n  line-height: 1.6;\n}\n\n/* Code syntax highlighting */\ncode .c { color: var(--color-text-muted); }\ncode .k { color: #a855f7; }\ncode .s { color: #22c55e; }\ncode .f { color: #3b82f6; }\n\n/* ============ Info Grid ============ */\n.info-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 16px;\n}\n\n.info-item {\n  background: var(--color-bg-tertiary);\n  padding: 16px;\n  border-radius: var(--radius-md);\n}\n\n.info-label {\n  font-size: 12px;\n  color: var(--color-text-muted);\n  text-transform: uppercase;\n  margin-bottom: 4px;\n}\n\n.info-value {\n  font-family: monospace;\n  font-size: 14px;\n  color: var(--color-text-primary);\n  word-break: break-all;\n}\n\n/* ============ Card ============ */\n.card {\n  background: var(--color-bg-secondary);\n  border-radius: var(--radius-lg);\n  padding: 24px;\n  box-shadow: var(--shadow-card);\n}\n\n.card h2 {\n  font-size: 18px;\n  color: var(--color-text-primary);\n  margin-bottom: 16px;\n  padding-bottom: 12px;\n  border-bottom: 1px solid var(--color-border);\n}\n\n/* ============ Container (centered card) ============ */\n.container-card {\n  background: var(--color-bg-secondary);\n  border-radius: var(--radius-xl);\n  padding: 24px;\n  max-width: 360px;\n  width: 100%;\n  text-align: center;\n  box-shadow: var(--shadow-elevated);\n}\n\n/* ============ Responsive ============ */\n@media (max-width: 640px) {\n  .top-controls {\n    top: 12px;\n    right: 12px;\n  }\n\n  .ctrl-btn {\n    width: 36px;\n    height: 36px;\n  }\n\n  select.ctrl-btn.lang {\n    padding: 0 8px;\n    padding-right: 20px;\n    font-size: 11px;\n  }\n}\n",
    mimeType: "text/css",
    isBase64: false,
  },
  "/public/js/common.js": {
    content: "/**\n * Remote Inject - Common Utilities\n * Theme (dark/light) + i18n support\n */\n\n// ============ Theme Support ============\n\nconst ThemeManager = {\n  init() {\n    // Check URL parameter first (highest priority for embedded use)\n    const urlParams = new URLSearchParams(window.location.search)\n    const urlTheme = urlParams.get('theme')\n\n    if (urlTheme === 'dark' || urlTheme === 'light') {\n      this.setTheme(urlTheme, false) // Don't save URL-specified theme to localStorage\n      return\n    }\n\n    // Apply saved theme or detect system preference\n    const saved = localStorage.getItem('theme')\n    if (saved) {\n      this.setTheme(saved)\n    } else {\n      // Auto-detect system preference\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n      this.setTheme(prefersDark ? 'dark' : 'light')\n    }\n\n    // Listen for system preference changes\n    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {\n      if (!localStorage.getItem('theme')) {\n        this.setTheme(e.matches ? 'dark' : 'light')\n      }\n    })\n  },\n\n  setTheme(theme, save = true) {\n    document.documentElement.setAttribute('data-theme', theme)\n    if (save) {\n      localStorage.setItem('theme', theme)\n      // Also set cookie for server-side rendering\n      document.cookie = `theme=${theme};path=/;max-age=31536000;SameSite=Lax`\n    }\n  },\n\n  toggle() {\n    const current = document.documentElement.getAttribute('data-theme')\n    this.setTheme(current === 'dark' ? 'light' : 'dark')\n  },\n\n  get current() {\n    return document.documentElement.getAttribute('data-theme') || 'light'\n  }\n}\n\n// ============ i18n Support ============\n\nconst I18n = {\n  // Supported languages\n  locales: {\n    zh: {\n      // Common\n      'app.name': 'Remote Inject',\n      'common.loading': '加载中...',\n      'common.error': '错误',\n      'common.retry': '重试',\n      'common.copy': '复制',\n      'common.copied': '已复制!',\n      'common.close': '关闭',\n\n      // Landing page\n      'landing.title': '连接钱包',\n      'landing.connectRequest': '请求连接到您的钱包',\n      'landing.checkingWallet': '检测钱包环境...',\n      'landing.selectWallet': '检测到多个钱包，请选择：',\n      'landing.walletDetected': '检测到 {name}，正在跳转...',\n      'landing.noWallet': '未检测到可用钱包',\n      'landing.invalidSession': '无效的会话链接',\n      'landing.invalidLink': '链接无效或已过期',\n      'landing.redirecting': '正在跳转...',\n      'landing.useWallet': '点击使用此钱包连接',\n      'landing.guideTitle': '请在钱包中打开此链接',\n      'landing.guideStep1': '打开您的加密钱包应用',\n      'landing.guideStep2': '进入 DApp 浏览器',\n      'landing.guideStep3': '粘贴下方链接并访问',\n      'landing.copyLink': '复制链接',\n      'landing.noWalletEnv': '未检测到钱包环境',\n\n      // Bridge page\n      'bridge.title': '连接确认',\n      'bridge.connecting': '正在连接...',\n      'bridge.pleaseWait': '请稍候',\n      'bridge.connected': '已连接',\n      'bridge.waitingRequest': '等待应用发起请求',\n      'bridge.confirmInWallet': '请在钱包中确认',\n      'bridge.requestingAction': '应用正在请求操作',\n      'bridge.disconnect': '断开连接',\n      'bridge.keepOpen': '保持此页面打开以维持连接',\n      'bridge.wallet': '使用钱包',\n      'bridge.address': '钱包地址',\n      'bridge.network': '当前网络',\n      'bridge.error': '出错了',\n      'bridge.reconnect': '请重新扫码连接',\n      'bridge.invalidLink': '链接无效或已过期，请重新扫描二维码',\n      'bridge.noWallet': '请在钱包的 DApp 浏览器中打开此链接',\n      'bridge.disconnected': '已断开连接',\n      'bridge.userDisconnected': '您已主动断开与应用的连接',\n      'bridge.peerDisconnected': '对方已关闭连接',\n      'bridge.connectionRejected': '链接无效或已被其他设备使用',\n      'bridge.connectionFailed': '链接无效、已过期或已被其他设备使用',\n      'bridge.sessionExpired': '链接已过期，请重新扫描二维码',\n      'bridge.connectingWallet': '正在连接 {name}...',\n      'bridge.authorizeInPopup': '请在弹窗中授权',\n      'bridge.noAccount': '请在钱包中授权访问',\n      'bridge.connectingApp': '正在连接应用...',\n      'bridge.almostDone': '即将完成',\n      'bridge.unknownApp': '未知应用',\n\n      // Methods\n      'method.personal_sign': '签名消息',\n      'method.eth_signTypedData_v4': '签名数据',\n      'method.eth_sendTransaction': '发送交易',\n      'method.wallet_switchEthereumChain': '切换网络',\n      'method.wallet_addEthereumChain': '添加网络',\n      'method.eth_sign': '签名',\n\n      // Demo page\n      'demo.title': 'Remote Inject Demo',\n      'demo.subtitle': '在电脑上连接移动钱包，体验跨设备签名',\n      'demo.connectWallet': '连接钱包',\n      'demo.createConnection': '创建连接',\n      'demo.disconnectConnection': '断开连接',\n      'demo.connectionStatus': '连接状态',\n      'demo.notConnected': '未连接',\n      'demo.waitingConnection': '等待连接...',\n      'demo.testActions': '测试操作',\n      'demo.getAccounts': '获取账户',\n      'demo.getChainId': '获取链 ID',\n      'demo.getBalance': '获取余额',\n      'demo.signMessage': '签名消息',\n      'demo.sendTransaction': '发送交易',\n    },\n\n    en: {\n      // Common\n      'app.name': 'Remote Inject',\n      'common.loading': 'Loading...',\n      'common.error': 'Error',\n      'common.retry': 'Retry',\n      'common.copy': 'Copy',\n      'common.copied': 'Copied!',\n      'common.close': 'Close',\n\n      // Landing page\n      'landing.title': 'Connect Wallet',\n      'landing.connectRequest': 'Requesting to connect to your wallet',\n      'landing.checkingWallet': 'Detecting wallet environment...',\n      'landing.selectWallet': 'Multiple wallets detected, please select:',\n      'landing.walletDetected': 'Detected {name}, redirecting...',\n      'landing.noWallet': 'No wallet detected',\n      'landing.invalidSession': 'Invalid session link',\n      'landing.invalidLink': 'Link is invalid or expired',\n      'landing.redirecting': 'Redirecting...',\n      'landing.useWallet': 'Click to connect with this wallet',\n      'landing.guideTitle': 'Open this link in your wallet',\n      'landing.guideStep1': 'Open your crypto wallet app',\n      'landing.guideStep2': 'Go to DApp browser',\n      'landing.guideStep3': 'Paste the link below and visit',\n      'landing.copyLink': 'Copy Link',\n      'landing.noWalletEnv': 'No wallet environment detected',\n\n      // Bridge page\n      'bridge.title': 'Connection Confirmation',\n      'bridge.connecting': 'Connecting...',\n      'bridge.pleaseWait': 'Please wait',\n      'bridge.connected': 'Connected',\n      'bridge.waitingRequest': 'Waiting for app request',\n      'bridge.confirmInWallet': 'Please confirm in wallet',\n      'bridge.requestingAction': 'App is requesting action',\n      'bridge.disconnect': 'Disconnect',\n      'bridge.keepOpen': 'Keep this page open to maintain connection',\n      'bridge.wallet': 'Wallet',\n      'bridge.address': 'Address',\n      'bridge.network': 'Network',\n      'bridge.error': 'Error',\n      'bridge.reconnect': 'Please scan QR code again',\n      'bridge.invalidLink': 'Link is invalid or expired, please scan QR code again',\n      'bridge.noWallet': 'Please open this link in wallet DApp browser',\n      'bridge.disconnected': 'Disconnected',\n      'bridge.userDisconnected': 'You have disconnected from the app',\n      'bridge.peerDisconnected': 'Remote side has closed the connection',\n      'bridge.connectionRejected': 'Link is invalid or already used by another device',\n      'bridge.connectionFailed': 'Link is invalid, expired, or used by another device',\n      'bridge.sessionExpired': 'Link has expired, please scan QR code again',\n      'bridge.connectingWallet': 'Connecting to {name}...',\n      'bridge.authorizeInPopup': 'Please authorize in popup',\n      'bridge.noAccount': 'Please authorize wallet access',\n      'bridge.connectingApp': 'Connecting to app...',\n      'bridge.almostDone': 'Almost done',\n      'bridge.unknownApp': 'Unknown App',\n\n      // Methods\n      'method.personal_sign': 'Sign Message',\n      'method.eth_signTypedData_v4': 'Sign Data',\n      'method.eth_sendTransaction': 'Send Transaction',\n      'method.wallet_switchEthereumChain': 'Switch Network',\n      'method.wallet_addEthereumChain': 'Add Network',\n      'method.eth_sign': 'Sign',\n\n      // Demo page\n      'demo.title': 'Remote Inject Demo',\n      'demo.subtitle': 'Connect mobile wallet on desktop, experience cross-device signing',\n      'demo.connectWallet': 'Connect Wallet',\n      'demo.createConnection': 'Create Connection',\n      'demo.disconnectConnection': 'Disconnect',\n      'demo.connectionStatus': 'Connection Status',\n      'demo.notConnected': 'Not Connected',\n      'demo.waitingConnection': 'Waiting for connection...',\n      'demo.testActions': 'Test Actions',\n      'demo.getAccounts': 'Get Accounts',\n      'demo.getChainId': 'Get Chain ID',\n      'demo.getBalance': 'Get Balance',\n      'demo.signMessage': 'Sign Message',\n      'demo.sendTransaction': 'Send Transaction',\n    }\n  },\n\n  currentLocale: 'en',\n\n  init() {\n    // Check URL parameter first (highest priority for embedded use)\n    const urlParams = new URLSearchParams(window.location.search)\n    const urlLang = urlParams.get('lang')\n\n    if (urlLang && this.locales[urlLang]) {\n      this.currentLocale = urlLang\n      // Don't save URL-specified locale to localStorage\n    } else {\n      // Detect language from saved preference or browser\n      const saved = localStorage.getItem('locale')\n      if (saved && this.locales[saved]) {\n        this.currentLocale = saved\n      } else {\n        // Auto-detect from browser language\n        const browserLang = navigator.language.split('-')[0]\n        this.currentLocale = this.locales[browserLang] ? browserLang : 'en'\n      }\n    }\n\n    document.documentElement.setAttribute('lang', this.currentLocale)\n\n    // Auto-translate elements with data-i18n attribute\n    this.translatePage()\n  },\n\n  setLocale(locale) {\n    if (this.locales[locale]) {\n      this.currentLocale = locale\n      localStorage.setItem('locale', locale)\n      // Also set cookie for server-side rendering\n      document.cookie = `locale=${locale};path=/;max-age=31536000;SameSite=Lax`\n      document.documentElement.setAttribute('lang', locale)\n      this.translatePage()\n    }\n  },\n\n  t(key, params = {}) {\n    let text = this.locales[this.currentLocale]?.[key] || this.locales.en[key] || key\n\n    // Replace {param} placeholders\n    Object.entries(params).forEach(([k, v]) => {\n      text = text.replace(new RegExp(`\\\\{${k}\\\\}`, 'g'), v)\n    })\n\n    return text\n  },\n\n  translatePage() {\n    // Find all elements with data-i18n attribute\n    document.querySelectorAll('[data-i18n]').forEach(el => {\n      const key = el.getAttribute('data-i18n')\n      if (key) {\n        el.textContent = this.t(key)\n      }\n    })\n\n    // Find all elements with data-i18n-placeholder\n    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {\n      const key = el.getAttribute('data-i18n-placeholder')\n      if (key) {\n        el.placeholder = this.t(key)\n      }\n    })\n\n    // Find all elements with data-i18n-title\n    document.querySelectorAll('[data-i18n-title]').forEach(el => {\n      const key = el.getAttribute('data-i18n-title')\n      if (key) {\n        el.title = this.t(key)\n      }\n    })\n  }\n}\n\n// ============ Auto Initialize ============\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    ThemeManager.init()\n    I18n.init()\n  })\n} else {\n  ThemeManager.init()\n  I18n.init()\n}\n\n// Export for use in pages\nwindow.ThemeManager = ThemeManager\nwindow.I18n = I18n\n",
    mimeType: "application/javascript",
    isBase64: false,
  },
  "/public/logo.svg": {
    content: "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 128 128\" fill=\"none\">\n  <rect width=\"128\" height=\"128\" rx=\"24\" fill=\"#3b82f6\"/>\n  <path d=\"M40 48h48M40 64h48M40 80h32\" stroke=\"#fff\" stroke-width=\"8\" stroke-linecap=\"round\"/>\n  <circle cx=\"88\" cy=\"80\" r=\"16\" fill=\"#22c55e\"/>\n  <path d=\"M82 80l4 4 8-8\" stroke=\"#fff\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n</svg>\n",
    mimeType: "image/svg+xml",
    isBase64: false,
  },
  "/templates/landing.eta": {
    content: "<!DOCTYPE html>\n<html lang=\"<%= it.locale %>\"<% if (it.theme) { %> data-theme=\"<%= it.theme %>\"<% } %>>\n<head>\n  <%~ include('partials/head', it) %>\n  <title><%= it.t('app.name') %> - <%= it.t('landing.title') %></title>\n  <style>\n    /* Landing page specific styles */\n    body {\n      background: var(--color-accent-gradient);\n      min-height: 100vh;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n    }\n\n    .container {\n      background: var(--color-bg-secondary);\n      border-radius: var(--radius-xl);\n      padding: 24px;\n      max-width: 360px;\n      width: 100%;\n      text-align: center;\n      box-shadow: var(--shadow-elevated);\n    }\n\n    .dapp-name {\n      margin-bottom: 2px;\n    }\n\n    .connect-label {\n      font-size: 13px;\n      color: var(--color-text-muted);\n      margin-bottom: 12px;\n    }\n\n    .status {\n      margin-bottom: 16px;\n    }\n\n    .copy-btn {\n      margin-top: 12px;\n      padding: 10px 16px;\n      background: var(--color-accent);\n      color: white;\n      border: none;\n      border-radius: var(--radius-sm);\n      font-size: 14px;\n      cursor: pointer;\n      transition: background 0.2s;\n      width: 100%;\n    }\n\n    .copy-btn:hover {\n      background: var(--color-accent-hover);\n    }\n\n    .copy-btn:active {\n      transform: scale(0.98);\n    }\n\n    /* Wallet selector */\n    .wallet-selector {\n      margin-bottom: 16px;\n    }\n\n    .wallet-selector h3 {\n      font-size: 13px;\n      color: var(--color-text-secondary);\n      margin-bottom: 10px;\n    }\n\n    .wallet-list {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    }\n\n    .wallet-btn {\n      display: flex;\n      align-items: center;\n      padding: 10px 12px;\n      background: var(--color-bg-tertiary);\n      border: 2px solid transparent;\n      border-radius: var(--radius-md);\n      cursor: pointer;\n      transition: all 0.2s;\n      text-align: left;\n    }\n\n    .wallet-btn:hover {\n      background: var(--color-bg-primary);\n      border-color: var(--color-accent);\n    }\n\n    .wallet-btn:active {\n      transform: scale(0.98);\n    }\n\n    .wallet-btn-icon {\n      width: 28px;\n      height: 28px;\n      border-radius: var(--radius-sm);\n      background: var(--color-accent-gradient);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-size: 12px;\n      font-weight: bold;\n      margin-right: 10px;\n      overflow: hidden;\n      flex-shrink: 0;\n    }\n\n    .wallet-btn-icon img {\n      width: 100%;\n      height: 100%;\n      object-fit: contain;\n    }\n\n    .wallet-btn-name {\n      font-size: 14px;\n      font-weight: 500;\n      color: var(--color-text-primary);\n    }\n\n    .wallet-btn-desc {\n      font-size: 11px;\n      color: var(--color-text-muted);\n      margin-top: 1px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <!-- DApp info - horizontal layout -->\n    <div class=\"dapp-info\">\n      <div class=\"dapp-icon\" id=\"dappIcon\"><% if (it.dapp?.icon) { %>\n        <img src=\"<%= it.dapp.icon %>\" alt=\"\" onerror=\"this.parentElement.textContent='<%= (it.dapp.name || '?')[0].toUpperCase() %>'\">\n      <% } else { %><%= (it.dapp?.name || '?')[0].toUpperCase() %><% } %></div>\n      <div class=\"dapp-text\">\n        <div class=\"dapp-name\" id=\"dappName\"><%= it.dapp?.name || it.t('landing.connectRequest') %></div>\n        <div class=\"dapp-url\" id=\"dappUrl\"><%= it.dapp?.host || '' %></div>\n      </div>\n    </div>\n\n    <div class=\"status checking\" id=\"status\">\n      <span class=\"spinner\"></span>\n      <%= it.t('landing.checkingWallet') %>\n    </div>\n\n    <!-- Wallet selector (shown when multiple wallets detected) -->\n    <div class=\"wallet-selector\" id=\"walletSelector\" style=\"display: none;\">\n      <h3><%= it.t('landing.selectWallet') %></h3>\n      <div class=\"wallet-list\" id=\"walletList\"></div>\n    </div>\n\n    <div class=\"guide\" id=\"guide\" style=\"display: none;\">\n      <h3><%= it.t('landing.guideTitle') %></h3>\n      <ol>\n        <li><%= it.t('landing.guideStep1') %></li>\n        <li><%= it.t('landing.guideStep2') %></li>\n        <li><%= it.t('landing.guideStep3') %></li>\n      </ol>\n      <button class=\"copy-btn\" onclick=\"copyLink()\"><%= it.t('landing.copyLink') %></button>\n    </div>\n  </div>\n\n  <!-- i18n data -->\n  <script type=\"application/json\" id=\"i18n-data\"><%~ it.translationsJson %></script>\n\n  <script>\n    // Server-injected data\n    const SESSION_ID = '<%= it.sessionId %>'\n    const SECRET = '<%= it.secret %>'\n    const LOCALE = '<%= it.locale %>'\n    const THEME = '<%= it.theme || '' %>'\n\n    // Build bridge URL with lang/theme params (preserve any URL query params)\n    function getBridgeUrl() {\n      const currentParams = new URLSearchParams(window.location.search)\n      let url = `/bridge?session=${SESSION_ID}&k=${SECRET}`\n      // Priority: URL param > SSR value\n      const lang = currentParams.get('lang') || LOCALE\n      const theme = currentParams.get('theme') || THEME\n      if (lang) url += `&lang=${lang}`\n      if (theme) url += `&theme=${theme}`\n\n      // For Safe App iframe: store in localStorage AND URL hash (double backup)\n      // Safe's iframe navigation might strip query params and block sessionStorage\n      if (isSafeApp() && (lang || theme)) {\n        const paramsData = JSON.stringify({ lang, theme, ts: Date.now() })\n        try {\n          localStorage.setItem('ri_bridge_params', paramsData)\n        } catch (e) {}\n        // Also encode in URL hash as backup\n        url += '#ri=' + encodeURIComponent(paramsData)\n      }\n\n      return url\n    }\n\n    // i18n translations (from server)\n    const I18N = JSON.parse(document.getElementById('i18n-data').textContent)\n\n    // Translate function\n    function t(key, params = {}) {\n      let text = I18N[key] || key\n      Object.entries(params).forEach(([k, v]) => {\n        text = text.replace(new RegExp(`\\\\{${k}\\\\}`, 'g'), v)\n      })\n      return text\n    }\n\n    // Security: validate image URL (prevent XSS)\n    function isValidImageUrl(url) {\n      if (!url || typeof url !== 'string') return false\n      if (url.startsWith('data:image/')) return true\n      try {\n        const parsed = new URL(url)\n        return parsed.protocol === 'http:' || parsed.protocol === 'https:'\n      } catch {\n        return false\n      }\n    }\n\n    // EIP-6963 wallet discovery\n    const eip6963Providers = []\n\n    window.addEventListener('eip6963:announceProvider', (event) => {\n      const { info, provider } = event.detail\n      if (!eip6963Providers.find(p => p.info.uuid === info.uuid)) {\n        eip6963Providers.push({ info, provider })\n        console.log('[Landing] EIP-6963 discovered wallet:', info.name)\n      }\n    })\n\n    window.dispatchEvent(new Event('eip6963:requestProvider'))\n\n    // Get wallet name for a provider (fallback for non-EIP-6963 wallets)\n    function getWalletName(provider) {\n      if (!provider) return t('bridge.unknownApp')\n      // Safe Wallet detection\n      if (provider.isSafe || provider.isSafeWallet) return 'Safe'\n      if (provider.isTokenPocket) return 'TokenPocket'\n      if (provider.isTrust) return 'Trust Wallet'\n      if (provider.isImToken) return 'imToken'\n      if (provider.isMathWallet) return 'Math Wallet'\n      if (provider.isBitKeep || provider.isBitget) return 'Bitget Wallet'\n      if (provider.isOKExWallet || provider.isOkxWallet) return 'OKX Wallet'\n      if (provider.isCoinbaseWallet) return 'Coinbase Wallet'\n      if (provider.isRainbow) return 'Rainbow'\n      if (provider.isMetaMask && !provider.isBraveWallet) return 'MetaMask'\n      if (provider.isBraveWallet) return 'Brave Wallet'\n      if (provider.isPhantom) return 'Phantom'\n      if (provider.isOneInch) return '1inch Wallet'\n      // Kraken Wallet detection\n      if (provider.isKraken) return 'Kraken Wallet'\n      return t('bridge.wallet')\n    }\n\n    // Detect all available providers (EIP-6963 + legacy)\n    function detectAllProviders() {\n      const result = []\n\n      // 1. Prefer EIP-6963 discovered wallets\n      eip6963Providers.forEach(({ info, provider }, index) => {\n        result.push({\n          provider,\n          uuid: info.uuid,\n          name: info.name,\n          icon: info.icon,\n          index,\n          source: 'eip6963'\n        })\n      })\n\n      if (result.length > 0) {\n        return result\n      }\n\n      // 2. Fallback to window.ethereum.providers array\n      const ethereum = window.ethereum\n      if (!ethereum) return []\n\n      if (ethereum.providers && Array.isArray(ethereum.providers) && ethereum.providers.length > 0) {\n        return ethereum.providers.map((provider, index) => ({\n          provider,\n          index,\n          name: getWalletName(provider),\n          source: 'providers'\n        }))\n      }\n\n      // 3. Single provider\n      return [{\n        provider: ethereum,\n        index: 0,\n        name: getWalletName(ethereum),\n        source: 'ethereum'\n      }]\n    }\n\n    // Select wallet and redirect\n    function selectWallet(walletData) {\n      document.getElementById('walletSelector').style.display = 'none'\n      document.getElementById('status').className = 'status success'\n      document.getElementById('status').textContent = t('landing.redirecting')\n\n      sessionStorage.setItem('selectedWallet', JSON.stringify({\n        index: walletData.index,\n        uuid: walletData.uuid,\n        source: walletData.source\n      }))\n\n      setTimeout(() => {\n        window.location.href = getBridgeUrl()\n      }, 300)\n    }\n\n    // Render wallet selector list (safe: using DOM API)\n    function renderWalletSelector(providers) {\n      const listEl = document.getElementById('walletList')\n      listEl.innerHTML = ''\n\n      providers.forEach((wallet) => {\n        const btn = document.createElement('button')\n        btn.className = 'wallet-btn'\n        btn.onclick = () => selectWallet(wallet)\n\n        const iconDiv = document.createElement('div')\n        iconDiv.className = 'wallet-btn-icon'\n\n        if (wallet.icon && isValidImageUrl(wallet.icon)) {\n          const img = document.createElement('img')\n          img.src = wallet.icon\n          img.alt = ''\n          img.onerror = () => {\n            iconDiv.textContent = (wallet.name || '?')[0].toUpperCase()\n          }\n          iconDiv.appendChild(img)\n        } else {\n          iconDiv.textContent = (wallet.name || '?')[0].toUpperCase()\n        }\n\n        const textDiv = document.createElement('div')\n        const nameDiv = document.createElement('div')\n        nameDiv.className = 'wallet-btn-name'\n        nameDiv.textContent = wallet.name || t('bridge.unknownApp')\n        const descDiv = document.createElement('div')\n        descDiv.className = 'wallet-btn-desc'\n        descDiv.textContent = t('landing.useWallet')\n        textDiv.appendChild(nameDiv)\n        textDiv.appendChild(descDiv)\n\n        btn.appendChild(iconDiv)\n        btn.appendChild(textDiv)\n        listEl.appendChild(btn)\n      })\n\n      document.getElementById('walletSelector').style.display = 'block'\n      document.getElementById('status').className = 'status checking'\n      document.getElementById('status').innerHTML = '<span class=\"spinner\"></span>' + t('landing.selectWallet')\n    }\n\n    // Check if running inside Safe App iframe\n    function isSafeApp() {\n      try {\n        // Safe Apps run in iframe\n        if (window.parent !== window && window.self !== window.top) {\n          return true\n        }\n      } catch (e) {\n        // Cross-origin iframe access error - likely Safe or similar\n        return true\n      }\n      return false\n    }\n\n    // Initialize wallet detection with retry mechanism for mobile wallets\n    async function initWalletDetection() {\n      const maxRetries = 10\n      const retryDelay = 300  // 300ms between retries, total ~3s max wait\n\n      for (let attempt = 0; attempt < maxRetries; attempt++) {\n        // Wait before checking (give wallet time to inject)\n        await new Promise(resolve => setTimeout(resolve, retryDelay))\n\n        // Re-dispatch EIP-6963 request on each attempt\n        window.dispatchEvent(new Event('eip6963:requestProvider'))\n\n        // Check for EIP-6963 providers or window.ethereum\n        const hasProvider = eip6963Providers.length > 0 || typeof window.ethereum !== 'undefined'\n\n        if (hasProvider) {\n          const providers = detectAllProviders()\n          console.log('[Landing] Attempt', attempt + 1, '- Detected wallets:', providers.length, providers.map(p => p.name))\n\n          if (providers.length > 0) {\n            if (providers.length > 1) {\n              renderWalletSelector(providers)\n            } else {\n              const wallet = providers[0]\n              sessionStorage.setItem('selectedWallet', JSON.stringify({\n                index: wallet.index,\n                uuid: wallet.uuid,\n                source: wallet.source\n              }))\n\n              document.getElementById('status').className = 'status success'\n              document.getElementById('status').textContent = t('landing.walletDetected', { name: wallet.name })\n\n              setTimeout(() => {\n                window.location.href = getBridgeUrl()\n              }, 500)\n            }\n            return\n          }\n        }\n\n        // Log retry progress\n        if (attempt < maxRetries - 1) {\n          console.log('[Landing] No wallet found, retrying... attempt', attempt + 1)\n        }\n      }\n\n      // After all retries, show no wallet error\n      console.log('[Landing] No wallet detected after', maxRetries, 'attempts')\n      document.getElementById('status').className = 'status error'\n      document.getElementById('status').textContent = t('landing.noWallet')\n      document.getElementById('guide').style.display = 'block'\n    }\n\n    // Initialize - always try detection with retry mechanism\n    if (!SESSION_ID) {\n      document.getElementById('status').className = 'status error'\n      document.getElementById('status').textContent = t('landing.invalidSession')\n    } else if (!SECRET) {\n      document.getElementById('status').className = 'status error'\n      document.getElementById('status').textContent = t('landing.invalidLink')\n    } else if (isSafeApp()) {\n      // In Safe App environment, skip wallet detection and go directly to bridge\n      // Bridge page will handle Safe Apps Provider creation\n      console.log('[Landing] Safe App detected, redirecting to bridge...')\n      document.getElementById('status').className = 'status success'\n      document.getElementById('status').textContent = t('landing.safeDetected')\n      setTimeout(() => {\n        window.location.href = getBridgeUrl()\n      }, 500)\n    } else {\n      // Always start detection - the retry mechanism will handle delayed injection\n      initWalletDetection()\n    }\n\n    function copyLink() {\n      const link = window.location.href\n      navigator.clipboard.writeText(link).then(() => {\n        const btn = document.querySelector('.copy-btn')\n        btn.textContent = t('common.copied')\n        setTimeout(() => {\n          btn.textContent = t('landing.copyLink')\n        }, 2000)\n      })\n    }\n  </script>\n\n  <%~ include('partials/footer', it) %>\n</body>\n</html>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/index.eta": {
    content: "<!DOCTYPE html>\n<html lang=\"<%= it.locale %>\"<% if (it.theme) { %> data-theme=\"<%= it.theme %>\"<% } %>>\n<head>\n  <%~ include('partials/head', it) %>\n  <title>Remote Inject</title>\n  <style>\n    /* Index page specific styles */\n    body {\n      min-height: 100vh;\n    }\n\n    .top-controls {\n      top: 20px;\n      right: 20px;\n      z-index: 100;\n    }\n\n    .ctrl-btn {\n      width: 36px;\n      height: 36px;\n    }\n\n    select.ctrl-btn.lang {\n      border-radius: 18px;\n    }\n\n    /* Hero */\n    .hero {\n      min-height: 100vh;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      text-align: center;\n      padding: 60px 24px;\n      position: relative;\n    }\n\n    .hero::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 600px;\n      height: 600px;\n      background: radial-gradient(circle, var(--color-accent-muted) 0%, transparent 70%);\n      opacity: 0.5;\n      pointer-events: none;\n    }\n\n    .hero-badge {\n      display: inline-block;\n      padding: 6px 14px;\n      background: var(--color-accent-muted);\n      color: var(--color-accent);\n      border-radius: 20px;\n      font-size: 12px;\n      font-weight: 500;\n      margin-bottom: 24px;\n      letter-spacing: 0.5px;\n    }\n\n    .hero h1 {\n      font-size: clamp(48px, 10vw, 72px);\n      font-weight: 700;\n      letter-spacing: -2px;\n      margin-bottom: 20px;\n      background: var(--color-accent-gradient);\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n    }\n\n    .hero-desc {\n      font-size: 18px;\n      color: var(--color-text-secondary);\n      max-width: 480px;\n      margin: 0 auto 40px;\n      line-height: 1.7;\n    }\n\n    .hero-actions {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n      justify-content: center;\n    }\n\n    .btn-primary:hover {\n      transform: translateY(-1px);\n    }\n\n    .btn svg {\n      width: 16px;\n      height: 16px;\n    }\n\n    /* Scroll hint */\n    .scroll-hint {\n      position: absolute;\n      bottom: 40px;\n      left: 50%;\n      transform: translateX(-50%);\n      color: var(--color-text-muted);\n      font-size: 12px;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 8px;\n      animation: bounce 2s infinite;\n    }\n\n    @keyframes bounce {\n      0%, 100% { transform: translateX(-50%) translateY(0); }\n      50% { transform: translateX(-50%) translateY(6px); }\n    }\n\n    /* Sections */\n    .section {\n      padding: 80px 24px;\n      max-width: 900px;\n      margin: 0 auto;\n    }\n\n    .section-title {\n      font-size: 28px;\n      font-weight: 600;\n      text-align: center;\n      margin-bottom: 48px;\n      letter-spacing: -0.5px;\n    }\n\n    /* Features - card grid */\n    .features {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 16px;\n    }\n\n    .feature {\n      padding: 24px;\n      background: var(--color-bg-secondary);\n      border: 1px solid var(--color-border);\n      border-radius: 12px;\n      transition: border-color 0.2s, box-shadow 0.2s;\n    }\n\n    .feature:hover {\n      border-color: var(--color-accent);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    }\n\n    .feature-icon {\n      width: 44px;\n      height: 44px;\n      background: var(--color-accent-muted);\n      border-radius: 10px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--color-accent);\n      margin-bottom: 16px;\n    }\n\n    .feature h3 {\n      font-size: 16px;\n      font-weight: 600;\n      margin-bottom: 8px;\n    }\n\n    .feature p {\n      font-size: 14px;\n      color: var(--color-text-secondary);\n      line-height: 1.6;\n    }\n\n    /* Flow diagram */\n    .flow {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 16px;\n      flex-wrap: wrap;\n      padding: 40px 0;\n    }\n\n    .flow-box {\n      padding: 16px 24px;\n      background: var(--color-bg-secondary);\n      border: 1px solid var(--color-border);\n      border-radius: 10px;\n      text-align: center;\n      min-width: 120px;\n    }\n\n    .flow-box.highlight {\n      border-color: var(--color-accent);\n      background: var(--color-accent-muted);\n    }\n\n    .flow-box h4 {\n      font-size: 13px;\n      font-weight: 600;\n      margin-bottom: 2px;\n    }\n\n    .flow-box p {\n      font-size: 11px;\n      color: var(--color-text-muted);\n    }\n\n    .flow-arrow {\n      color: var(--color-text-muted);\n      font-size: 18px;\n    }\n\n    .flow-desc {\n      text-align: center;\n      font-size: 14px;\n      color: var(--color-text-secondary);\n      max-width: 600px;\n      margin: 0 auto;\n    }\n\n    /* Code block - using base.css styles with overrides */\n    .code-block {\n      border-radius: 10px;\n    }\n\n    /* Install command */\n    .install-cmd {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 12px;\n      padding: 16px 24px;\n      background: var(--color-bg-secondary);\n      border: 1px solid var(--color-border);\n      border-radius: 8px;\n      max-width: 400px;\n      margin: 0 auto 40px;\n    }\n\n    .install-cmd code {\n      font-family: 'SF Mono', Monaco, Consolas, monospace;\n      font-size: 14px;\n      color: var(--color-text-primary);\n    }\n\n    .install-cmd button {\n      padding: 6px 12px;\n      font-size: 12px;\n      background: var(--color-accent);\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      transition: background 0.15s;\n    }\n\n    .install-cmd button:hover {\n      background: var(--color-accent-hover);\n    }\n\n    /* Footer */\n    .footer {\n      text-align: center;\n      padding: 40px 24px;\n      border-top: 1px solid var(--color-border);\n      font-size: 13px;\n      color: var(--color-text-muted);\n    }\n\n    .footer a {\n      color: var(--color-accent);\n      text-decoration: none;\n    }\n\n    .footer a:hover {\n      text-decoration: underline;\n    }\n\n    /* Safe App Mode */\n    .safe-app-container {\n      min-height: 100vh;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 24px;\n      text-align: center;\n    }\n\n    .safe-app-logo {\n      width: 80px;\n      height: 80px;\n      margin-bottom: 24px;\n    }\n\n    .safe-app-title {\n      font-size: 24px;\n      font-weight: 600;\n      margin-bottom: 12px;\n    }\n\n    .safe-app-desc {\n      font-size: 14px;\n      color: var(--color-text-secondary);\n      margin-bottom: 32px;\n      max-width: 400px;\n    }\n\n    .safe-app-input-group {\n      width: 100%;\n      max-width: 500px;\n      margin-bottom: 16px;\n    }\n\n    .safe-app-input {\n      width: 100%;\n      padding: 14px 16px;\n      font-size: 14px;\n      border: 1px solid var(--color-border);\n      border-radius: 10px;\n      background: var(--color-bg-secondary);\n      color: var(--color-text-primary);\n      outline: none;\n      transition: border-color 0.2s;\n    }\n\n    .safe-app-input:focus {\n      border-color: var(--color-accent);\n    }\n\n    .safe-app-input::placeholder {\n      color: var(--color-text-muted);\n    }\n\n    .safe-app-btn {\n      width: 100%;\n      max-width: 500px;\n      padding: 14px 24px;\n      font-size: 15px;\n      font-weight: 500;\n      background: var(--color-accent);\n      color: white;\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    .safe-app-btn:hover {\n      background: var(--color-accent-hover);\n    }\n\n    .safe-app-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .safe-app-error {\n      color: #ef4444;\n      font-size: 13px;\n      margin-top: 12px;\n    }\n\n    .safe-app-hint {\n      font-size: 12px;\n      color: var(--color-text-muted);\n      margin-top: 24px;\n      max-width: 400px;\n    }\n\n    .safe-app-hint code {\n      background: var(--color-bg-tertiary);\n      padding: 2px 6px;\n      border-radius: 4px;\n      font-family: 'SF Mono', Monaco, Consolas, monospace;\n      font-size: 11px;\n    }\n\n    /* Config section */\n    .config-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 24px;\n    }\n\n    .config-card {\n      background: var(--color-bg-secondary);\n      border: 1px solid var(--color-border);\n      border-radius: 12px;\n      padding: 24px;\n    }\n\n    .config-card h3 {\n      font-size: 16px;\n      font-weight: 600;\n      margin-bottom: 12px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .config-card h3 svg {\n      color: var(--color-accent);\n    }\n\n    .config-card p {\n      font-size: 13px;\n      color: var(--color-text-secondary);\n      margin-bottom: 16px;\n      line-height: 1.6;\n    }\n\n    .config-card pre {\n      background: var(--color-bg-tertiary);\n      border-radius: 8px;\n      padding: 12px;\n      font-size: 12px;\n      overflow-x: auto;\n    }\n\n    .config-card code {\n      font-family: 'SF Mono', Monaco, Consolas, monospace;\n    }\n\n    .config-tree {\n      font-family: 'SF Mono', Monaco, Consolas, monospace;\n      font-size: 12px;\n      color: var(--color-text-secondary);\n      line-height: 1.8;\n    }\n\n    .config-tree .dir { color: var(--color-accent); }\n    .config-tree .file { color: var(--color-text-primary); }\n    .config-tree .comment { color: var(--color-text-muted); font-style: italic; }\n\n    /* Responsive */\n    @media (max-width: 768px) {\n      .features { grid-template-columns: 1fr; }\n      .config-grid { grid-template-columns: 1fr; }\n      .hero { padding: 40px 20px; }\n      .hero h1 { font-size: 36px; letter-spacing: -1px; }\n      .hero-desc { font-size: 16px; }\n      .section { padding: 60px 20px; }\n      .section-title { font-size: 24px; margin-bottom: 32px; }\n    }\n\n    @media (max-width: 640px) {\n      .flow { flex-direction: column; }\n      .flow-arrow { transform: rotate(90deg); }\n      .top-controls { top: 12px; right: 12px; }\n      .ctrl-btn { width: 32px; height: 32px; }\n      select.ctrl-btn.lang { padding: 0 8px; padding-right: 20px; font-size: 11px; }\n    }\n  </style>\n</head>\n<body>\n  <!-- Safe App Mode Container (hidden by default, shown when in Safe iframe) -->\n  <div id=\"safeAppContainer\" class=\"safe-app-container\" style=\"display: none;\">\n    <img src=\"/logo.svg\" alt=\"Remote Inject\" class=\"safe-app-logo\">\n    <h1 class=\"safe-app-title\">Remote Inject</h1>\n    <p class=\"safe-app-desc\">\n      <% if (it.locale === 'zh') { %>\n        粘贴 DApp 生成的连接链接，开始使用 Safe 钱包签名\n      <% } else { %>\n        Paste the connection link from DApp to sign with Safe wallet\n      <% } %>\n    </p>\n    <div class=\"safe-app-input-group\">\n      <input\n        type=\"text\"\n        id=\"sessionUrlInput\"\n        class=\"safe-app-input\"\n        placeholder=\"<% if (it.locale === 'zh') { %>粘贴链接，如：https://xxx/s/ABCD?k=...<% } else { %>Paste link, e.g.: https://xxx/s/ABCD?k=...<% } %>\"\n      >\n    </div>\n    <button id=\"connectBtn\" class=\"safe-app-btn\" onclick=\"handleConnect()\">\n      <% if (it.locale === 'zh') { %>连接<% } else { %>Connect<% } %>\n    </button>\n    <div id=\"safeAppError\" class=\"safe-app-error\" style=\"display: none;\"></div>\n    <p class=\"safe-app-hint\">\n      <% if (it.locale === 'zh') { %>\n        提示：链接格式为 <code>/s/会话ID?k=密钥</code>，从 DApp 的二维码获取\n      <% } else { %>\n        Hint: Link format is <code>/s/sessionId?k=secret</code>, get it from DApp's QR code\n      <% } %>\n    </p>\n  </div>\n\n  <!-- Normal page content (hidden when in Safe App mode) -->\n  <div id=\"normalContent\">\n  <div class=\"top-controls\">\n    <select class=\"ctrl-btn lang\" id=\"langSelect\" onchange=\"changeLang(this.value)\">\n      <% const localeNames = { en: 'EN', zh: '中文', ja: '日本語', ko: '한국어', es: 'ES', fr: 'FR', de: 'DE' } %>\n      <% (it.availableLocales || ['en', 'zh']).forEach(loc => { %>\n        <option value=\"<%= loc %>\" <%= it.locale === loc ? 'selected' : '' %>><%= localeNames[loc] || loc.toUpperCase() %></option>\n      <% }) %>\n    </select>\n    <button class=\"ctrl-btn\" onclick=\"toggleTheme()\" id=\"themeBtn\">\n      <svg id=\"themeIcon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"></svg>\n    </button>\n  </div>\n\n  <!-- Hero -->\n  <section class=\"hero\">\n    <span class=\"hero-badge\">Open Source WalletConnect Alternative</span>\n    <h1>Remote Inject</h1>\n    <p class=\"hero-desc\">\n      <% if (it.locale === 'zh') { %>\n        用移动钱包为桌面 DApp 签名。扫码即连，无需下载。\n      <% } else { %>\n        Sign for desktop DApps with your mobile wallet. Scan to connect, no download needed.\n      <% } %>\n    </p>\n    <div class=\"hero-actions\">\n      <a href=\"/demo\" class=\"btn btn-primary\">\n        <% if (it.locale === 'zh') { %>试用 Demo<% } else { %>Try Demo<% } %>\n      </a>\n      <a href=\"https://github.com/atshelchin/remote-inject\" class=\"btn btn-ghost\" target=\"_blank\">\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z\"/></svg>\n        GitHub\n      </a>\n    </div>\n    <div class=\"scroll-hint\">\n      <span><% if (it.locale === 'zh') { %>向下滚动<% } else { %>Scroll<% } %></span>\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 5v14M19 12l-7 7-7-7\"/></svg>\n    </div>\n  </section>\n\n  <!-- Features -->\n  <section class=\"section\">\n    <h2 class=\"section-title\"><% if (it.locale === 'zh') { %>为什么选择 Remote Inject<% } else { %>Why Remote Inject<% } %></h2>\n    <div class=\"features\">\n      <div class=\"feature\">\n        <div class=\"feature-icon\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4\"/><path d=\"M9 18c-4.51 2-5-2-7-2\"/></svg>\n        </div>\n        <h3><% if (it.locale === 'zh') { %>开源自托管<% } else { %>Open Source<% } %></h3>\n        <p><% if (it.locale === 'zh') { %>完全开源，可自行部署。数据完全掌控。<% } else { %>Fully open source. Deploy on your own server.<% } %></p>\n      </div>\n      <div class=\"feature\">\n        <div class=\"feature-icon\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect width=\"7\" height=\"12\" x=\"2\" y=\"6\" rx=\"1\"/><rect width=\"7\" height=\"9\" x=\"15\" y=\"4\" rx=\"1\"/><path d=\"M9 9h6M9 13h6\"/></svg>\n        </div>\n        <h3><% if (it.locale === 'zh') { %>跨设备签名<% } else { %>Cross-Device<% } %></h3>\n        <p><% if (it.locale === 'zh') { %>桌面发起，手机确认。私钥不离开手机。<% } else { %>Initiate on desktop, confirm on mobile.<% } %></p>\n      </div>\n      <div class=\"feature\">\n        <div class=\"feature-icon\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"m18 16 4-4-4-4\"/><path d=\"m6 8-4 4 4 4\"/><path d=\"m14.5 4-5 16\"/></svg>\n        </div>\n        <h3><% if (it.locale === 'zh') { %>简单集成<% } else { %>Easy Integration<% } %></h3>\n        <p><% if (it.locale === 'zh') { %>标准 EIP-1193，兼容主流 Web3 库。<% } else { %>Standard EIP-1193, works with any Web3 library.<% } %></p>\n      </div>\n      <div class=\"feature\">\n        <div class=\"feature-icon\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/></svg>\n        </div>\n        <h3><% if (it.locale === 'zh') { %>可定制<% } else { %>Customizable<% } %></h3>\n        <p><% if (it.locale === 'zh') { %>自定义多语言和主题，无需改代码。<% } else { %>Custom i18n and themes without code changes.<% } %></p>\n      </div>\n    </div>\n  </section>\n\n  <!-- How it works -->\n  <section class=\"section\">\n    <h2 class=\"section-title\"><% if (it.locale === 'zh') { %>工作原理<% } else { %>How It Works<% } %></h2>\n    <div class=\"flow\">\n      <div class=\"flow-box\">\n        <h4><% if (it.locale === 'zh') { %>桌面 DApp<% } else { %>Desktop DApp<% } %></h4>\n        <p>SDK Provider</p>\n      </div>\n      <span class=\"flow-arrow\">→</span>\n      <div class=\"flow-box highlight\">\n        <h4>Relay Server</h4>\n        <p>WebSocket</p>\n      </div>\n      <span class=\"flow-arrow\">→</span>\n      <div class=\"flow-box\">\n        <h4><% if (it.locale === 'zh') { %>移动钱包<% } else { %>Mobile Wallet<% } %></h4>\n        <p>Bridge Page</p>\n      </div>\n    </div>\n    <p class=\"flow-desc\">\n      <% if (it.locale === 'zh') { %>\n        SDK 通过 Relay 服务器将请求转发到移动端 Bridge 页面，由钱包中的真实 Provider 处理并返回结果。\n      <% } else { %>\n        SDK forwards requests via Relay server to mobile Bridge page, where your real wallet provider handles them.\n      <% } %>\n    </p>\n  </section>\n\n  <!-- Quick Start -->\n  <section class=\"section\">\n    <h2 class=\"section-title\"><% if (it.locale === 'zh') { %>快速开始<% } else { %>Quick Start<% } %></h2>\n\n    <div class=\"install-cmd\">\n      <code>npm i @shelchin/remote-inject-sdk</code>\n      <button onclick=\"copyInstall(this)\">Copy</button>\n    </div>\n\n    <div class=\"code-block\">\n      <div class=\"code-header\">\n        <span>JavaScript</span>\n        <button class=\"code-copy\" onclick=\"copyCode(this)\">Copy</button>\n      </div>\n      <pre><code><span class=\"k\">import</span> { RemoteProvider } <span class=\"k\">from</span> <span class=\"s\">'@shelchin/remote-inject-sdk'</span>\n\n<span class=\"c\">// Create and connect</span>\n<span class=\"k\">const</span> provider = <span class=\"k\">new</span> <span class=\"f\">RemoteProvider</span>()\n<span class=\"k\">const</span> { url } = <span class=\"k\">await</span> provider.<span class=\"f\">connect</span>(<span class=\"s\">'https://your-server.com'</span>)\n\n<span class=\"c\">// Show QR code for mobile to scan</span>\nshowQRCode(url)\n\n<span class=\"c\">// Use like any EIP-1193 provider</span>\n<span class=\"k\">const</span> accounts = <span class=\"k\">await</span> provider.<span class=\"f\">request</span>({ method: <span class=\"s\">'eth_requestAccounts'</span> })</code></pre>\n    </div>\n  </section>\n\n  <!-- Self-hosting -->\n  <section class=\"section\">\n    <h2 class=\"section-title\"><% if (it.locale === 'zh') { %>自托管部署<% } else { %>Self-Hosting<% } %></h2>\n    <div class=\"code-block\">\n      <div class=\"code-header\">\n        <span>Terminal</span>\n        <button class=\"code-copy\" onclick=\"copyCode(this)\">Copy</button>\n      </div>\n      <pre><code><span class=\"c\"># Clone and install</span>\ngit clone https://github.com/atshelchin/remote-inject\ncd remote-inject && bun install\n\n<span class=\"c\"># Run server</span>\nbun run --filter @shelchin/remote-inject-server start\n\n<span class=\"c\"># Or build single executable</span>\nbun run --filter @shelchin/remote-inject-server build</code></pre>\n    </div>\n  </section>\n\n  <!-- Customization -->\n  <section class=\"section\">\n    <h2 class=\"section-title\"><% if (it.locale === 'zh') { %>定制配置<% } else { %>Customization<% } %></h2>\n    <div class=\"config-grid\">\n      <div class=\"config-card\">\n        <h3>\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"/></svg>\n          <% if (it.locale === 'zh') { %>多语言 (i18n)<% } else { %>Internationalization<% } %>\n        </h3>\n        <p><% if (it.locale === 'zh') { %>在配置目录添加翻译文件即可新增语言。<% } else { %>Add translation files to config directory for new languages.<% } %></p>\n        <pre class=\"config-tree\"><span class=\"dir\">~/.remote-inject/</span>\n└── <span class=\"dir\">locales/</span>\n    ├── <span class=\"file\">en.json</span>  <span class=\"comment\"># override English</span>\n    └── <span class=\"file\">pt.json</span>  <span class=\"comment\"># add Portuguese</span></pre>\n      </div>\n      <div class=\"config-card\">\n        <h3>\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"13.5\" cy=\"6.5\" r=\"0.5\" fill=\"currentColor\"/><circle cx=\"17.5\" cy=\"10.5\" r=\"0.5\" fill=\"currentColor\"/><circle cx=\"8.5\" cy=\"7.5\" r=\"0.5\" fill=\"currentColor\"/><circle cx=\"6.5\" cy=\"12.5\" r=\"0.5\" fill=\"currentColor\"/><path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z\"/></svg>\n          <% if (it.locale === 'zh') { %>自定义主题<% } else { %>Custom Themes<% } %>\n        </h3>\n        <p><% if (it.locale === 'zh') { %>添加 CSS 文件覆盖默认样式变量。<% } else { %>Add CSS file to override default style variables.<% } %></p>\n        <pre class=\"config-tree\"><span class=\"dir\">~/.remote-inject/</span>\n└── <span class=\"dir\">themes/</span>\n    └── <span class=\"file\">custom.css</span></pre>\n        <pre><code><span class=\"c\">/* custom.css */</span>\n:root {\n  --color-accent: #e11d48;\n}</code></pre>\n      </div>\n    </div>\n  </section>\n\n  <!-- Footer -->\n  <footer class=\"footer\">\n    <p>\n      <% if (it.locale === 'zh') { %>\n        由 <a href=\"https://github.com/atshelchin\" target=\"_blank\">@atshelchin</a> 构建\n      <% } else { %>\n        Built by <a href=\"https://github.com/atshelchin\" target=\"_blank\">@atshelchin</a>\n      <% } %>\n    </p>\n  </footer>\n  </div><!-- End normalContent -->\n\n  <script src=\"/js/common.js\"></script>\n  <script>\n    // Safe App Detection and Handling\n    const LOCALE = '<%= it.locale %>'\n\n    function isSafeApp() {\n      try {\n        // Safe Apps run in iframe\n        if (window.parent !== window && window.self !== window.top) {\n          return true\n        }\n      } catch (e) {\n        // Cross-origin iframe access error - likely Safe or similar\n        return true\n      }\n      return false\n    }\n\n    function parseSessionUrl(urlStr) {\n      try {\n        // Handle both full URLs and relative paths\n        let url\n        if (urlStr.startsWith('http://') || urlStr.startsWith('https://')) {\n          url = new URL(urlStr)\n        } else if (urlStr.startsWith('/')) {\n          url = new URL(urlStr, window.location.origin)\n        } else {\n          // Try to parse as full URL anyway\n          url = new URL(urlStr)\n        }\n\n        // Extract lang and theme from pasted URL (if present)\n        const lang = url.searchParams.get('lang')\n        const theme = url.searchParams.get('theme')\n\n        // Check for /s/:id format\n        const pathMatch = url.pathname.match(/\\/s\\/([A-Za-z0-9]+)/)\n        if (pathMatch) {\n          const sessionId = pathMatch[1]\n          const secret = url.searchParams.get('k')\n          if (sessionId && secret) {\n            return { sessionId, secret, lang, theme }\n          }\n        }\n\n        // Check for /landing or /bridge format\n        const sessionId = url.searchParams.get('session')\n        const secret = url.searchParams.get('k')\n        if (sessionId && secret) {\n          return { sessionId, secret, lang, theme }\n        }\n\n        return null\n      } catch (e) {\n        return null\n      }\n    }\n\n    function showError(message) {\n      const errorEl = document.getElementById('safeAppError')\n      errorEl.textContent = message\n      errorEl.style.display = 'block'\n    }\n\n    function hideError() {\n      document.getElementById('safeAppError').style.display = 'none'\n    }\n\n    function handleConnect() {\n      hideError()\n      const input = document.getElementById('sessionUrlInput')\n      const urlStr = input.value.trim()\n\n      if (!urlStr) {\n        showError(LOCALE === 'zh' ? '请输入连接链接' : 'Please enter a connection link')\n        return\n      }\n\n      const parsed = parseSessionUrl(urlStr)\n      if (!parsed) {\n        showError(LOCALE === 'zh' ? '无效的链接格式' : 'Invalid link format')\n        return\n      }\n\n      // Build bridge URL with lang/theme params\n      let bridgeUrl = `/bridge?session=${encodeURIComponent(parsed.sessionId)}&k=${encodeURIComponent(parsed.secret)}`\n\n      // Use lang/theme from pasted URL if available, otherwise use current page settings\n      const lang = parsed.lang || LOCALE\n      const theme = parsed.theme || ThemeManager.current\n\n      if (lang) bridgeUrl += `&lang=${encodeURIComponent(lang)}`\n      if (theme) bridgeUrl += `&theme=${encodeURIComponent(theme)}`\n\n      // For Safe App: also store in localStorage and URL hash as backup\n      if (isSafeApp() && (lang || theme)) {\n        const paramsData = JSON.stringify({ lang, theme, ts: Date.now() })\n        try {\n          localStorage.setItem('ri_bridge_params', paramsData)\n        } catch (e) {}\n        bridgeUrl += '#ri=' + encodeURIComponent(paramsData)\n      }\n\n      console.log('[Index] Navigating to bridge:', bridgeUrl)\n      window.location.href = bridgeUrl\n    }\n\n    // Check if in Safe App mode on page load\n    if (isSafeApp()) {\n      document.getElementById('safeAppContainer').style.display = 'flex'\n      document.getElementById('normalContent').style.display = 'none'\n\n      // Allow Enter key to submit\n      document.getElementById('sessionUrlInput').addEventListener('keypress', (e) => {\n        if (e.key === 'Enter') {\n          handleConnect()\n        }\n      })\n    }\n\n    function toggleTheme() {\n      ThemeManager.toggle()\n      updateThemeIcon()\n    }\n\n    function updateThemeIcon() {\n      const icon = document.getElementById('themeIcon')\n      if (ThemeManager.current === 'dark') {\n        icon.innerHTML = '<circle cx=\"12\" cy=\"12\" r=\"5\"/><path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/>'\n      } else {\n        icon.innerHTML = '<path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"/>'\n      }\n    }\n    updateThemeIcon()\n\n    function changeLang(newLang) {\n      document.cookie = `locale=${newLang};path=/;max-age=31536000;SameSite=Lax`\n      localStorage.setItem('locale', newLang)\n      const url = new URL(window.location.href)\n      url.searchParams.delete('lang')\n      window.location.href = url.toString()\n    }\n\n    function copyInstall(btn) {\n      navigator.clipboard.writeText('npm i @shelchin/remote-inject-sdk').then(() => {\n        btn.textContent = '<%= it.locale === \"zh\" ? \"已复制\" : \"Copied\" %>'\n        setTimeout(() => btn.textContent = 'Copy', 1500)\n      })\n    }\n\n    function copyCode(btn) {\n      const code = btn.closest('.code-block').querySelector('code').textContent\n      navigator.clipboard.writeText(code).then(() => {\n        btn.textContent = '<%= it.locale === \"zh\" ? \"已复制\" : \"Copied\" %>'\n        setTimeout(() => btn.textContent = 'Copy', 1500)\n      })\n    }\n  </script>\n</body>\n</html>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/demo.eta": {
    content: "<!DOCTYPE html>\n<html lang=\"<%= it.locale %>\"<% if (it.theme) { %> data-theme=\"<%= it.theme %>\"<% } %>>\n<head>\n  <%~ include('partials/head', it) %>\n  <title><%= it.t('demo.title') %></title>\n  <style>\n    /* Demo page specific styles */\n    body {\n      min-height: 100vh;\n      padding: 40px 20px;\n    }\n\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 14px;\n    }\n\n    h1 {\n      text-align: center;\n      color: var(--color-text-primary);\n      margin-bottom: 8px;\n    }\n\n    .subtitle {\n      text-align: center;\n      color: var(--color-text-secondary);\n      margin-bottom: 40px;\n    }\n\n    .card {\n      margin-bottom: 24px;\n    }\n\n    .qr-container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 24px;\n    }\n\n    #qrcode {\n      background: white;\n      padding: 16px;\n      border-radius: var(--radius-md);\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    }\n\n    .session-url-container {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-top: 16px;\n      max-width: 100%;\n    }\n\n    .session-url {\n      flex: 1;\n      padding: 12px 16px;\n      background: var(--color-bg-tertiary);\n      border-radius: var(--radius-sm);\n      font-family: monospace;\n      font-size: 14px;\n      word-break: break-all;\n      color: var(--color-text-primary);\n    }\n\n    .btn-copy {\n      padding: 12px 16px;\n      background: var(--color-accent);\n      color: white;\n      border: none;\n      border-radius: var(--radius-sm);\n      font-size: 14px;\n      cursor: pointer;\n      transition: all 0.2s;\n      white-space: nowrap;\n    }\n\n    .btn-copy:hover {\n      background: var(--color-accent-hover);\n    }\n\n    .btn-copy.copied {\n      background: var(--color-success);\n    }\n\n    .status-badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px 16px;\n      border-radius: 20px;\n      font-size: 14px;\n      font-weight: 500;\n    }\n\n    .status-badge.disconnected {\n      background: var(--color-error-bg);\n      color: var(--color-error);\n    }\n\n    .status-badge.connecting {\n      background: var(--color-warning-bg);\n      color: var(--color-warning);\n    }\n\n    .status-badge.connected {\n      background: var(--color-success-bg);\n      color: var(--color-success);\n    }\n\n    .status-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n    }\n\n    .status-badge.disconnected .status-dot {\n      background: var(--color-error);\n    }\n\n    .status-badge.connecting .status-dot {\n      background: var(--color-warning);\n      animation: status-pulse 1s infinite;\n    }\n\n    .status-badge.connected .status-dot {\n      background: var(--color-success);\n    }\n\n    @keyframes status-pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.5; }\n    }\n\n    .info-item {\n      margin-bottom: 12px;\n    }\n\n    .btn-group {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n      margin-top: 16px;\n    }\n\n    .result-box {\n      margin-top: 16px;\n      padding: 16px;\n      background: #1a1a2e;\n      border-radius: var(--radius-md);\n      max-height: 300px;\n      overflow-y: auto;\n    }\n\n    .result-box pre {\n      font-family: monospace;\n      font-size: 13px;\n      color: #4ade80;\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n\n    .result-box .error {\n      color: #f87171;\n    }\n\n    .result-box .info {\n      color: #60a5fa;\n    }\n\n    /* Fixed buttons */\n    .fixed-btns {\n      position: fixed;\n      top: 16px;\n      right: 16px;\n      z-index: 1000;\n      display: flex;\n      gap: 8px;\n    }\n\n    .fixed-btn {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      border: 1px solid var(--color-border);\n      background: var(--color-bg-secondary);\n      color: var(--color-text-secondary);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 16px;\n      box-shadow: var(--shadow-sm);\n      transition: all 0.2s;\n    }\n\n    .fixed-btn:hover {\n      border-color: var(--color-accent);\n      color: var(--color-accent);\n    }\n\n    .lang-btn {\n      width: auto;\n      padding: 0 14px;\n      border-radius: 20px;\n      font-size: 13px;\n      font-weight: 500;\n    }\n\n    .toggle-btn {\n      padding: 6px 14px;\n      border: 1px solid var(--color-border);\n      border-radius: 6px;\n      background: var(--color-bg-secondary);\n      color: var(--color-text-secondary);\n      font-size: 13px;\n      cursor: pointer;\n      transition: all 0.15s;\n    }\n\n    .toggle-btn:hover {\n      border-color: var(--color-accent);\n      color: var(--color-accent);\n    }\n\n    .toggle-btn.active {\n      background: var(--color-accent);\n      border-color: var(--color-accent);\n      color: white;\n    }\n\n    /* Action groups */\n    .action-group {\n      margin-bottom: 20px;\n      padding-bottom: 16px;\n      border-bottom: 1px solid var(--color-border);\n    }\n\n    .action-group:last-of-type {\n      border-bottom: none;\n      margin-bottom: 0;\n    }\n\n    .action-group-title {\n      font-size: 13px;\n      font-weight: 500;\n      color: var(--color-text-muted);\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n      margin-bottom: 12px;\n    }\n\n    .chain-switch-group {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      flex: 1;\n    }\n\n    /* Unified select styling */\n    .styled-select {\n      appearance: none;\n      -webkit-appearance: none;\n      padding: 10px 32px 10px 14px;\n      border: 1px solid var(--color-border);\n      border-radius: var(--radius-md);\n      background: var(--color-bg-secondary);\n      color: var(--color-text-primary);\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    }\n\n    .styled-select:hover:not(:disabled) {\n      border-color: var(--color-accent);\n      background-color: var(--color-bg-tertiary);\n    }\n\n    .styled-select:focus {\n      outline: none;\n      border-color: var(--color-accent);\n      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);\n    }\n\n    .styled-select:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .chain-select {\n      min-width: 180px;\n      flex: 1;\n    }\n\n    /* Account select in status card */\n    .account-select-wrapper {\n      width: 100%;\n    }\n\n    .account-select {\n      width: 100%;\n      padding: 8px 32px 8px 12px;\n      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;\n      font-size: 13px;\n      background-color: var(--color-bg-tertiary);\n    }\n\n    .account-count {\n      font-size: 11px;\n      color: var(--color-text-muted);\n      font-weight: normal;\n      margin-left: 4px;\n    }\n\n    /* Chain indicator in status */\n    .chain-indicator {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      padding: 6px 12px;\n      background: var(--color-bg-tertiary);\n      border-radius: var(--radius-sm);\n      font-size: 13px;\n      font-weight: 500;\n    }\n\n    .chain-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      background: var(--color-success);\n    }\n  </style>\n</head>\n<body>\n  <div class=\"fixed-btns\">\n    <select class=\"fixed-btn lang-btn\" id=\"langSelect\" onchange=\"changeLang(this.value)\" title=\"Language\">\n      <% const localeNames = { en: 'English', zh: '中文', ja: '日本語', ko: '한국어', es: 'Español', fr: 'Français', de: 'Deutsch' } %>\n      <% (it.availableLocales || ['en', 'zh']).forEach(loc => { %>\n        <option value=\"<%= loc %>\" <%= it.locale === loc ? 'selected' : '' %>><%= localeNames[loc] || loc.toUpperCase() %></option>\n      <% }) %>\n    </select>\n    <button class=\"fixed-btn\" onclick=\"toggleTheme()\" title=\"Toggle theme\">\n      <span id=\"themeIcon\"></span>\n    </button>\n  </div>\n\n  <div class=\"container\">\n    <h1><%= it.t('demo.title') %></h1>\n    <p class=\"subtitle\"><%= it.t('demo.subtitle') %></p>\n\n    <!-- Connect Card -->\n    <div class=\"card\" id=\"connectCard\">\n      <h2><%= it.t('demo.connectWallet') %></h2>\n\n      <!-- QR Code area - hidden until connection created -->\n      <div class=\"qr-container hidden\" id=\"qrContainer\">\n        <div id=\"qrcode\"></div>\n        <p style=\"margin-top: 16px; color: var(--color-text-secondary); font-size: 14px; text-align: center;\">\n          <% if (it.locale === 'zh') { %>使用手机钱包扫描二维码连接<% } else { %>Scan QR code with your mobile wallet<% } %>\n        </p>\n        <div class=\"session-url-container\">\n          <div class=\"session-url\" id=\"sessionUrl\"></div>\n          <button class=\"btn-copy\" id=\"copyBtn\" onclick=\"copySessionUrl()\"><%= it.t('common.copy') %></button>\n        </div>\n      </div>\n\n      <!-- Config section - shown before connection -->\n      <div id=\"configSection\">\n        <div class=\"config-section\" style=\"background: var(--color-bg-tertiary); border-radius: var(--radius-md); padding: 16px; margin-bottom: 20px;\">\n          <div class=\"config-title\" style=\"font-size: 13px; color: var(--color-text-muted); margin-bottom: 12px; text-transform: uppercase;\">\n            <% if (it.locale === 'zh') { %>连接配置<% } else { %>Connection Config<% } %>\n          </div>\n          <div class=\"config-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;\">\n            <div class=\"config-item\">\n              <label style=\"display: block; color: var(--color-text-secondary); font-size: 12px; margin-bottom: 4px;\"><% if (it.locale === 'zh') { %>应用名称<% } else { %>App Name<% } %></label>\n              <input type=\"text\" id=\"appName\" value=\"Remote Inject Demo\" style=\"width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-bg-secondary); color: var(--color-text-primary); font-size: 14px;\">\n            </div>\n            <div class=\"config-item\">\n              <label style=\"display: block; color: var(--color-text-secondary); font-size: 12px; margin-bottom: 4px;\"><% if (it.locale === 'zh') { %>应用 URL<% } else { %>App URL<% } %></label>\n              <input type=\"text\" id=\"appUrl\" placeholder=\"https://example.com\" style=\"width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-bg-secondary); color: var(--color-text-primary); font-size: 14px;\">\n            </div>\n            <div class=\"config-item\">\n              <label style=\"display: block; color: var(--color-text-secondary); font-size: 12px; margin-bottom: 4px;\"><% if (it.locale === 'zh') { %>Logo URL<% } else { %>Logo URL<% } %></label>\n              <input type=\"text\" id=\"appIcon\" placeholder=\"https://example.com/icon.png\" style=\"width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-bg-secondary); color: var(--color-text-primary); font-size: 14px;\">\n            </div>\n          </div>\n          <!-- Wallet page options as button groups -->\n          <div style=\"display: flex; flex-wrap: wrap; gap: 24px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--color-border);\">\n            <div class=\"config-item\" style=\"flex: 1; min-width: 200px;\">\n              <label style=\"display: block; color: var(--color-text-secondary); font-size: 12px; margin-bottom: 8px;\"><% if (it.locale === 'zh') { %>钱包页语言<% } else { %>Wallet Language<% } %></label>\n              <div class=\"toggle-group\" id=\"walletLangGroup\" style=\"display: flex; flex-wrap: wrap; gap: 6px;\">\n                <button type=\"button\" class=\"toggle-btn active\" data-value=\"\" onclick=\"setWalletLang('')\"><% if (it.locale === 'zh') { %>自动<% } else { %>Auto<% } %></button>\n                <% (it.availableLocales || ['en', 'zh']).forEach(loc => { %>\n                  <button type=\"button\" class=\"toggle-btn\" data-value=\"<%= loc %>\" onclick=\"setWalletLang('<%= loc %>')\"><%= localeNames[loc] || loc.toUpperCase() %></button>\n                <% }) %>\n              </div>\n              <input type=\"hidden\" id=\"walletLang\" value=\"\">\n            </div>\n            <div class=\"config-item\" style=\"flex: 1; min-width: 200px;\">\n              <label style=\"display: block; color: var(--color-text-secondary); font-size: 12px; margin-bottom: 8px;\"><% if (it.locale === 'zh') { %>钱包页主题<% } else { %>Wallet Theme<% } %></label>\n              <div class=\"toggle-group\" id=\"walletThemeGroup\" style=\"display: flex; flex-wrap: wrap; gap: 6px;\">\n                <button type=\"button\" class=\"toggle-btn active\" data-value=\"\" onclick=\"setWalletTheme('')\"><% if (it.locale === 'zh') { %>自动<% } else { %>Auto<% } %></button>\n                <button type=\"button\" class=\"toggle-btn\" data-value=\"light\" onclick=\"setWalletTheme('light')\"><% if (it.locale === 'zh') { %>浅色<% } else { %>Light<% } %></button>\n                <button type=\"button\" class=\"toggle-btn\" data-value=\"dark\" onclick=\"setWalletTheme('dark')\"><% if (it.locale === 'zh') { %>深色<% } else { %>Dark<% } %></button>\n              </div>\n              <input type=\"hidden\" id=\"walletTheme\" value=\"\">\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"btn-group\" style=\"justify-content: center;\">\n        <button class=\"btn btn-primary\" id=\"connectBtn\" onclick=\"startConnect()\"><%= it.t('demo.createConnection') %></button>\n        <button class=\"btn btn-danger hidden\" id=\"disconnectBtn\" onclick=\"disconnect()\"><%= it.t('demo.disconnectConnection') %></button>\n      </div>\n    </div>\n\n    <!-- Status Card -->\n    <div class=\"card\">\n      <h2><%= it.t('demo.connectionStatus') %></h2>\n      <div class=\"status-badge disconnected\" id=\"statusBadge\">\n        <div class=\"status-dot\"></div>\n        <span id=\"statusText\"><%= it.t('demo.notConnected') %></span>\n      </div>\n      <div class=\"info-grid\" id=\"walletInfo\" style=\"display: none;\">\n        <div class=\"info-item\">\n          <div class=\"info-label\"><%= it.t('bridge.address') %> <span id=\"accountCount\" class=\"account-count\"></span></div>\n          <div class=\"info-value account-select-wrapper\">\n            <select id=\"accountSelect\" class=\"styled-select account-select\" onchange=\"onAccountSelect(this.value)\">\n              <option value=\"\">-</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"info-item\">\n          <div class=\"info-label\"><% if (it.locale === 'zh') { %>链 ID<% } else { %>Chain ID<% } %></div>\n          <div class=\"info-value\" id=\"walletChainId\">-</div>\n        </div>\n        <div class=\"info-item\">\n          <div class=\"info-label\">Session</div>\n          <div class=\"info-value\" id=\"walletSession\">-</div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Test Card -->\n    <div class=\"card\">\n      <h2><%= it.t('demo.testActions') %></h2>\n\n      <!-- Chain Actions -->\n      <div class=\"action-group\">\n        <h3 class=\"action-group-title\"><%= it.t('demo.chainActions') %></h3>\n        <div class=\"btn-group\">\n          <button class=\"btn btn-secondary\" id=\"btnChainId\" onclick=\"testGetChainId()\" disabled><%= it.t('demo.getChainId') %></button>\n          <button class=\"btn btn-secondary\" id=\"btnBlockNumber\" onclick=\"testGetBlockNumber()\" disabled><%= it.t('demo.getBlockNumber') %></button>\n          <div class=\"chain-switch-group\">\n            <select id=\"chainSelect\" class=\"chain-select\" disabled>\n              <option value=\"0x1\">Ethereum (1)</option>\n              <option value=\"0x89\">Polygon (137)</option>\n              <option value=\"0xa4b1\">Arbitrum (42161)</option>\n              <option value=\"0xa\">Optimism (10)</option>\n              <option value=\"0x38\">BSC (56)</option>\n              <option value=\"0xa86a\">Avalanche (43114)</option>\n              <option value=\"0x2105\">Base (8453)</option>\n              <option value=\"0xaa36a7\">Sepolia (11155111)</option>\n            </select>\n            <button class=\"btn btn-primary\" id=\"btnSwitchChain\" onclick=\"testSwitchChain()\" disabled><%= it.t('demo.switchChain') %></button>\n          </div>\n        </div>\n      </div>\n\n      <!-- Account Actions -->\n      <div class=\"action-group\">\n        <h3 class=\"action-group-title\"><%= it.t('demo.accountActions') %></h3>\n        <div class=\"btn-group\">\n          <button class=\"btn btn-secondary\" id=\"btnAccounts\" onclick=\"testGetAccounts()\" disabled><%= it.t('demo.getAccounts') %></button>\n          <button class=\"btn btn-secondary\" id=\"btnBalance\" onclick=\"testGetBalance()\" disabled><%= it.t('demo.getBalance') %></button>\n          <button class=\"btn btn-secondary\" id=\"btnRequestAccounts\" onclick=\"testRequestAccounts()\" disabled><%= it.t('demo.requestAccounts') %></button>\n        </div>\n      </div>\n\n      <!-- Sign Actions -->\n      <div class=\"action-group\">\n        <h3 class=\"action-group-title\"><%= it.t('demo.signActions') %></h3>\n        <div class=\"btn-group\">\n          <button class=\"btn btn-primary\" id=\"btnSign\" onclick=\"testPersonalSign()\" disabled><%= it.t('demo.signMessage') %></button>\n          <button class=\"btn btn-primary\" id=\"btnSignTypedData\" onclick=\"testSignTypedData()\" disabled><%= it.t('demo.signTypedData') %></button>\n          <button class=\"btn btn-primary\" id=\"btnSend\" onclick=\"testSendTransaction()\" disabled><%= it.t('demo.sendTransaction') %></button>\n        </div>\n      </div>\n\n      <!-- Contract Actions -->\n      <div class=\"action-group\">\n        <h3 class=\"action-group-title\"><%= it.t('demo.contractActions') %></h3>\n        <div class=\"btn-group\">\n          <button class=\"btn btn-secondary\" id=\"btnReadContract\" onclick=\"testReadContract()\" disabled><%= it.t('demo.readContract') %></button>\n          <button class=\"btn btn-secondary\" id=\"btnEstimateGas\" onclick=\"testEstimateGas()\" disabled><%= it.t('demo.estimateGas') %></button>\n        </div>\n      </div>\n\n      <div class=\"result-box\">\n        <pre id=\"resultOutput\">// <% if (it.locale === 'zh') { %>测试结果将显示在这里<% } else { %>Test results will appear here<% } %></pre>\n      </div>\n    </div>\n  </div>\n\n  <!-- QRCode Library -->\n  <script src=\"https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js\"></script>\n  <script src=\"/js/common.js\"></script>\n\n  <!-- i18n data (embedded as JSON to avoid script parsing issues) -->\n  <script type=\"application/json\" id=\"i18n-data\"><%~ it.translationsJson %></script>\n\n  <script type=\"module\">\n    // i18n translations (from server)\n    const I18N = JSON.parse(document.getElementById('i18n-data').textContent)\n    const LOCALE = '<%= it.locale %>'\n\n    // Translate function\n    function t(key, params = {}) {\n      let text = I18N[key] || key\n      Object.entries(params).forEach(([k, v]) => {\n        text = text.replace(new RegExp(`\\\\{${k}\\\\}`, 'g'), v)\n      })\n      return text\n    }\n\n    // Theme toggle\n    window.toggleTheme = function() {\n      ThemeManager.toggle()\n      updateThemeIcon()\n    }\n\n    function updateThemeIcon() {\n      const icon = document.getElementById('themeIcon')\n      icon.textContent = ThemeManager.current === 'dark' ? '☀️' : '🌙'\n    }\n\n    updateThemeIcon()\n\n    // Set default appUrl to current origin\n    document.getElementById('appUrl').value = window.location.origin\n\n    // Language change\n    window.changeLang = function(newLang) {\n      if (newLang === '<%= it.locale %>') return\n      // Set cookie for server-side persistence\n      document.cookie = `locale=${newLang};path=/;max-age=31536000;SameSite=Lax`\n      localStorage.setItem('locale', newLang)\n      // Redirect without lang param (cookie will handle it)\n      const url = new URL(window.location.href)\n      url.searchParams.delete('lang')\n      window.location.href = url.toString()\n    }\n\n    // Wallet lang/theme toggle buttons\n    window.setWalletLang = function(value) {\n      document.getElementById('walletLang').value = value\n      document.querySelectorAll('#walletLangGroup .toggle-btn').forEach(btn => {\n        btn.classList.toggle('active', btn.dataset.value === value)\n      })\n    }\n\n    window.setWalletTheme = function(value) {\n      document.getElementById('walletTheme').value = value\n      document.querySelectorAll('#walletThemeGroup .toggle-btn').forEach(btn => {\n        btn.classList.toggle('active', btn.dataset.value === value)\n      })\n    }\n\n    // Session storage key\n    const SESSION_STORAGE_KEY = 'remoteInject_session'\n\n    // Save session to localStorage\n    function saveSession(sessionData) {\n      try {\n        localStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify({\n          ...sessionData,\n          savedAt: Date.now()\n        }))\n      } catch (e) {\n        console.error('[Demo] Failed to save session:', e)\n      }\n    }\n\n    // Load session from localStorage\n    function loadSession() {\n      try {\n        const stored = localStorage.getItem(SESSION_STORAGE_KEY)\n        if (!stored) return null\n        const session = JSON.parse(stored)\n        // Session expires after 24 hours\n        if (Date.now() - session.savedAt > 24 * 60 * 60 * 1000) {\n          clearSession()\n          return null\n        }\n        return session\n      } catch (e) {\n        console.error('[Demo] Failed to load session:', e)\n        return null\n      }\n    }\n\n    // Clear session from localStorage\n    function clearSession() {\n      try {\n        localStorage.removeItem(SESSION_STORAGE_KEY)\n      } catch (e) {\n        console.error('[Demo] Failed to clear session:', e)\n      }\n    }\n\n    // Check if session is still valid on server\n    async function checkSessionValid(sessionId) {\n      try {\n        const res = await fetch(`/session/${sessionId}`)\n        if (!res.ok) return false\n        const data = await res.json()\n        return data.status !== 'expired'\n      } catch (e) {\n        return false\n      }\n    }\n\n    // Inline Provider code (simplified for demo)\n    class RemoteProvider {\n      constructor() {\n        this.ws = null\n        this.serverUrl = ''\n        this.sessionId = ''\n        this.sessionUrl = ''\n        this.secret = ''  // Store secret for reconnection\n        this.requestId = 0\n        this.pendingRequests = new Map()\n        this.eventListeners = new Map()\n        this._chainId = '0x1'\n        this._accounts = []\n        this._connected = false\n        this._userInitiatedDisconnect = false\n        this._reconnectAttempts = 0\n        this._maxReconnectAttempts = 5\n        this._reconnectDelay = 1000\n\n        const events = ['connect', 'disconnect', 'chainChanged', 'accountsChanged', 'message', 'reconnecting']\n        events.forEach(event => this.eventListeners.set(event, new Set()))\n      }\n\n      async connect(serverUrl, metadata = {}) {\n        this.serverUrl = serverUrl.replace(/\\/$/, '')\n        this._userInitiatedDisconnect = false\n        this._reconnectAttempts = 0\n\n        const response = await fetch(`${this.serverUrl}/session`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(metadata),\n        })\n\n        if (!response.ok) {\n          throw new Error(`Failed to create session: ${response.statusText}`)\n        }\n\n        const data = await response.json()\n        this.sessionId = data.id\n        this.sessionUrl = data.url\n\n        // Extract secret from URL for reconnection\n        try {\n          const url = new URL(data.url)\n          this.secret = url.searchParams.get('k') || ''\n        } catch (e) {\n          this.secret = ''\n        }\n\n        await this.connectWebSocket()\n\n        // Save session for persistence\n        saveSession({\n          serverUrl: this.serverUrl,\n          sessionId: this.sessionId,\n          sessionUrl: this.sessionUrl,\n          secret: this.secret,\n          metadata\n        })\n\n        return {\n          sessionId: this.sessionId,\n          url: this.sessionUrl,\n        }\n      }\n\n      // Resume an existing session\n      async resumeSession(sessionData) {\n        this.serverUrl = sessionData.serverUrl\n        this.sessionId = sessionData.sessionId\n        this.sessionUrl = sessionData.sessionUrl\n        this.secret = sessionData.secret || ''\n        this._userInitiatedDisconnect = false\n        this._reconnectAttempts = 0\n\n        // Verify session is still valid\n        const isValid = await checkSessionValid(this.sessionId)\n        if (!isValid) {\n          clearSession()\n          throw new Error('Session expired or invalid')\n        }\n\n        await this.connectWebSocket()\n\n        return {\n          sessionId: this.sessionId,\n          url: this.sessionUrl,\n        }\n      }\n\n      connectWebSocket() {\n        return new Promise((resolve, reject) => {\n          const wsUrl = this.serverUrl.replace(/^http/, 'ws')\n          this.ws = new WebSocket(`${wsUrl}/ws?session=${this.sessionId}&role=dapp`)\n\n          const timeout = setTimeout(() => {\n            reject(new Error('WebSocket connection timeout'))\n            this.ws?.close()\n          }, 10000)\n\n          this.ws.onopen = () => {\n            clearTimeout(timeout)\n            this._reconnectAttempts = 0  // Reset on successful connection\n          }\n\n          this.ws.onmessage = (event) => {\n            this.handleMessage(event.data)\n            try {\n              const msg = JSON.parse(event.data)\n              if (msg.type === 'ready') {\n                resolve()\n              }\n            } catch {}\n          }\n\n          this.ws.onclose = (event) => {\n            this._connected = false\n\n            // Don't reconnect if user initiated disconnect\n            if (this._userInitiatedDisconnect) {\n              this.emit('disconnect', { code: 4900, message: 'User disconnected', userInitiated: true })\n              return\n            }\n\n            // Try to reconnect for non-user-initiated disconnects\n            if (this._reconnectAttempts < this._maxReconnectAttempts) {\n              this._reconnectAttempts++\n              const delay = this._reconnectDelay * Math.pow(1.5, this._reconnectAttempts - 1)\n              console.log(`[RemoteProvider] Connection lost, reconnecting in ${delay}ms (attempt ${this._reconnectAttempts}/${this._maxReconnectAttempts})`)\n\n              this.emit('reconnecting', { attempt: this._reconnectAttempts, maxAttempts: this._maxReconnectAttempts })\n\n              setTimeout(() => {\n                if (!this._userInitiatedDisconnect) {\n                  this.connectWebSocket().catch(err => {\n                    console.error('[RemoteProvider] Reconnect failed:', err)\n                  })\n                }\n              }, delay)\n            } else {\n              this.emit('disconnect', { code: 4900, message: 'Connection lost', userInitiated: false })\n            }\n          }\n\n          this.ws.onerror = (error) => {\n            clearTimeout(timeout)\n            reject(new Error('WebSocket connection failed'))\n          }\n        })\n      }\n\n      handleMessage(data) {\n        try {\n          const message = JSON.parse(data)\n\n          switch (message.type) {\n            case 'ready':\n              break\n\n            case 'connect':\n              this._connected = true\n              this._accounts = [message.address]\n              this._chainId = '0x' + message.chainId.toString(16)\n              this.emit('connect', { chainId: this._chainId })\n              this.emit('accountsChanged', this._accounts)\n              break\n\n            case 'disconnect':\n              this._connected = false\n              this._accounts = []\n              this.emit('disconnect', { code: 4900, message: message.reason || 'Disconnected' })\n              break\n\n            case 'response':\n              this.handleResponse(message)\n              break\n\n            case 'chainChanged':\n              this._chainId = '0x' + message.chainId.toString(16)\n              this.emit('chainChanged', this._chainId)\n              break\n\n            case 'accountsChanged':\n              this._accounts = message.accounts\n              this.emit('accountsChanged', this._accounts)\n              if (message.accounts.length === 0) {\n                this._connected = false\n                this.emit('disconnect', { code: 4900, message: 'Wallet disconnected' })\n              }\n              break\n\n            case 'error':\n              console.error('[RemoteProvider] Server error:', message)\n              break\n          }\n        } catch (error) {\n          console.error('[RemoteProvider] Failed to parse message:', error)\n        }\n      }\n\n      handleResponse(message) {\n        const pending = this.pendingRequests.get(message.id)\n        if (!pending) return\n\n        clearTimeout(pending.timeout)\n        this.pendingRequests.delete(message.id)\n\n        if (message.error) {\n          const error = new Error(message.error.message)\n          error.code = message.error.code\n          pending.reject(error)\n        } else {\n          pending.resolve(message.result)\n        }\n      }\n\n      async request(args) {\n        const { method, params } = args\n\n        switch (method) {\n          case 'eth_accounts':\n            return this._accounts\n\n          case 'eth_chainId':\n            return this._chainId\n\n          case 'eth_requestAccounts':\n            if (this._connected && this._accounts.length > 0) {\n              return this._accounts\n            }\n            return new Promise((resolve, reject) => {\n              const timeout = setTimeout(() => {\n                reject({ code: 4001, message: 'User rejected the request' })\n              }, 60000)\n\n              const handler = (accounts) => {\n                clearTimeout(timeout)\n                this.removeListener('accountsChanged', handler)\n                resolve(accounts)\n              }\n\n              this.on('accountsChanged', handler)\n            })\n        }\n\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n          throw { code: -32000, message: 'Not connected' }\n        }\n\n        if (!this._connected) {\n          throw { code: -32000, message: 'Mobile wallet not connected' }\n        }\n\n        return this.sendRequest(method, params)\n      }\n\n      sendRequest(method, params) {\n        return new Promise((resolve, reject) => {\n          const id = ++this.requestId\n\n          const timeout = setTimeout(() => {\n            this.pendingRequests.delete(id)\n            reject({ code: -32003, message: 'Request timeout' })\n          }, 60000)\n\n          this.pendingRequests.set(id, { resolve, reject, timeout })\n\n          this.ws.send(JSON.stringify({\n            type: 'request',\n            id,\n            method,\n            params: params || [],\n          }))\n        })\n      }\n\n      on(event, listener) {\n        this.eventListeners.get(event)?.add(listener)\n      }\n\n      removeListener(event, listener) {\n        this.eventListeners.get(event)?.delete(listener)\n      }\n\n      emit(event, ...args) {\n        this.eventListeners.get(event)?.forEach(listener => {\n          try {\n            listener(...args)\n          } catch (error) {\n            console.error(`[RemoteProvider] Event listener error:`, error)\n          }\n        })\n      }\n\n      disconnect() {\n        this._userInitiatedDisconnect = true  // Mark as user-initiated\n        if (this.ws) {\n          try {\n            this.ws.send(JSON.stringify({ type: 'disconnect', reason: 'User initiated' }))\n          } catch (e) {}\n          this.ws.close()\n          this.ws = null\n        }\n        this._connected = false\n        this._accounts = []\n        clearSession()  // Clear stored session on user disconnect\n      }\n\n      get isConnected() {\n        return this._connected\n      }\n\n      get accounts() {\n        return this._accounts\n      }\n\n      get chainId() {\n        return this._chainId\n      }\n\n      get session() {\n        return {\n          id: this.sessionId,\n          url: this.sessionUrl,\n        }\n      }\n    }\n\n    // Global variables\n    let provider = null\n    let currentAccount = null  // Currently selected account for operations\n\n    // Get current account (selected or first available)\n    function getCurrentAccount() {\n      return currentAccount || (provider?.accounts?.[0] ?? null)\n    }\n\n    // Update account selector with all available accounts\n    function updateAccountSelector(accounts) {\n      const select = document.getElementById('accountSelect')\n      const countSpan = document.getElementById('accountCount')\n\n      if (!select) return\n\n      // Clear existing options\n      select.innerHTML = ''\n\n      if (!accounts || accounts.length === 0) {\n        select.innerHTML = '<option value=\"\">-</option>'\n        if (countSpan) countSpan.textContent = ''\n        return\n      }\n\n      // Add all accounts\n      accounts.forEach((account, index) => {\n        const option = document.createElement('option')\n        option.value = account\n        // Show abbreviated address with index\n        const abbrev = account.slice(0, 8) + '...' + account.slice(-6)\n        option.textContent = accounts.length > 1 ? `[${index + 1}] ${abbrev}` : abbrev\n        option.title = account  // Full address on hover\n        select.appendChild(option)\n      })\n\n      // Show account count if multiple\n      if (countSpan) {\n        countSpan.textContent = accounts.length > 1 ? `(${accounts.length})` : ''\n      }\n\n      // Set current selection\n      if (currentAccount && accounts.includes(currentAccount)) {\n        select.value = currentAccount\n      } else {\n        currentAccount = accounts[0]\n        select.value = currentAccount\n      }\n    }\n\n    // Handle account selection change\n    window.onAccountSelect = function(address) {\n      if (!address) return\n      currentAccount = address\n      const abbrev = address.slice(0, 8) + '...' + address.slice(-6)\n      logResult(LOCALE === 'zh' ? `已切换到账户: ${abbrev}` : `Switched to account: ${abbrev}`, 'info')\n\n      // Notify bridge about account switch\n      if (provider && provider.ws && provider.ws.readyState === WebSocket.OPEN) {\n        provider.ws.send(JSON.stringify({\n          type: 'accountSwitch',\n          address: address\n        }))\n      }\n    }\n\n    // Try to fetch all authorized accounts using wallet_getPermissions\n    async function fetchAllAuthorizedAccounts() {\n      if (!provider || !provider.isConnected) return\n\n      try {\n        const permissions = await provider.request({ method: 'wallet_getPermissions' })\n        const ethAccountsPermission = permissions.find(p => p.parentCapability === 'eth_accounts')\n\n        if (ethAccountsPermission?.caveats) {\n          const caveat = ethAccountsPermission.caveats.find(c => c.type === 'restrictReturnedAccounts')\n          if (caveat?.value && Array.isArray(caveat.value) && caveat.value.length > 0) {\n            logResult(LOCALE === 'zh' ? `获取到 ${caveat.value.length} 个授权账户` : `Found ${caveat.value.length} authorized accounts`, 'info')\n            updateAccountSelector(caveat.value)\n            return caveat.value\n          }\n        }\n      } catch (error) {\n        // wallet_getPermissions not supported, use default accounts\n        console.log('[Demo] wallet_getPermissions not supported:', error.message)\n      }\n      return null\n    }\n\n    // Update status display\n    function updateStatus(status, text) {\n      const badge = document.getElementById('statusBadge')\n      const statusText = document.getElementById('statusText')\n\n      badge.className = `status-badge ${status}`\n      statusText.textContent = text\n\n      const buttons = [\n        'btnAccounts', 'btnChainId', 'btnBalance', 'btnSign', 'btnSend',\n        'btnSwitchChain', 'btnRequestAccounts', 'btnSignTypedData',\n        'btnReadContract', 'btnEstimateGas', 'btnBlockNumber'\n      ]\n      buttons.forEach(id => {\n        const el = document.getElementById(id)\n        if (el) el.disabled = status !== 'connected'\n      })\n\n      // Also enable/disable chain select\n      const chainSelect = document.getElementById('chainSelect')\n      if (chainSelect) chainSelect.disabled = status !== 'connected'\n\n      document.getElementById('walletInfo').style.display = status === 'connected' ? 'block' : 'none'\n    }\n\n    // Safe: escape HTML special characters\n    function escapeHtml(str) {\n      if (!str) return ''\n      return String(str)\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;')\n    }\n\n    // Log result (safe: escape message content)\n    function logResult(message, type = 'default') {\n      const output = document.getElementById('resultOutput')\n      const timestamp = new Date().toLocaleTimeString()\n      const className = type === 'error' ? 'error' : type === 'info' ? 'info' : ''\n      const escapedMessage = escapeHtml(message)\n      output.innerHTML = `<span class=\"${className}\">[${timestamp}] ${escapedMessage}</span>\\n` + output.innerHTML\n    }\n\n    // Start connect\n    window.startConnect = async function() {\n      try {\n        // Clear any existing session when starting new connection\n        clearSession()\n        document.getElementById('resumeBtn')?.remove()\n\n        document.getElementById('connectBtn').disabled = true\n        updateStatus('connecting', t('demo.waitingConnection'))\n        logResult(LOCALE === 'zh' ? '创建 Session...' : 'Creating session...', 'info')\n\n        provider = new RemoteProvider()\n\n        // Listen for events\n        provider.on('connect', async (info) => {\n          logResult(LOCALE === 'zh' ? `已连接，链 ID: ${info.chainId}` : `Connected, Chain ID: ${info.chainId}`, 'info')\n          updateStatus('connected', t('bridge.connected'))\n\n          document.getElementById('walletChainId').textContent = provider.chainId\n          document.getElementById('walletSession').textContent = provider.session.id\n\n          // Try to get all authorized accounts first\n          const allAccounts = await fetchAllAuthorizedAccounts()\n          if (!allAccounts) {\n            // Fallback to provider.accounts if wallet_getPermissions not supported\n            updateAccountSelector(provider.accounts)\n          }\n        })\n\n        provider.on('disconnect', (info) => {\n          logResult(LOCALE === 'zh' ? `已断开: ${info.message}` : `Disconnected: ${info.message}`, 'error')\n          updateStatus('disconnected', t('demo.notConnected'))\n\n          // Only show connect button if user initiated or max reconnects reached\n          if (info.userInitiated || !provider || provider._reconnectAttempts >= provider._maxReconnectAttempts) {\n            document.getElementById('connectBtn').classList.remove('hidden')\n            document.getElementById('disconnectBtn').classList.add('hidden')\n            document.getElementById('connectBtn').disabled = false\n            document.getElementById('qrcode').innerHTML = ''\n            document.getElementById('sessionUrl').textContent = ''\n            document.getElementById('qrContainer').classList.add('hidden')\n            document.getElementById('configSection').classList.remove('hidden')\n          }\n        })\n\n        provider.on('reconnecting', (info) => {\n          logResult(LOCALE === 'zh' ? `正在重连... (${info.attempt}/${info.maxAttempts})` : `Reconnecting... (${info.attempt}/${info.maxAttempts})`, 'info')\n          updateStatus('connecting', LOCALE === 'zh' ? '重新连接中...' : 'Reconnecting...')\n        })\n\n        provider.on('chainChanged', (chainId) => {\n          logResult(LOCALE === 'zh' ? `链已切换: ${chainId}` : `Chain changed: ${chainId}`, 'info')\n          document.getElementById('walletChainId').textContent = chainId\n        })\n\n        provider.on('accountsChanged', (accounts) => {\n          if (accounts.length > 0) {\n            logResult(LOCALE === 'zh' ? `账户已更新，共 ${accounts.length} 个账户` : `Accounts updated, ${accounts.length} account(s)`, 'info')\n            updateAccountSelector(accounts)\n          }\n        })\n\n        // Connect to server (pass DApp metadata from config)\n        const serverUrl = window.location.origin\n        const appName = document.getElementById('appName').value.trim() || 'Remote Inject Demo'\n        const appUrl = document.getElementById('appUrl').value.trim() || window.location.origin\n        const appIcon = document.getElementById('appIcon').value.trim() || undefined\n\n        const { sessionId, url } = await provider.connect(serverUrl, {\n          name: appName,\n          url: appUrl,\n          icon: appIcon,\n        })\n\n        // Show cancel button and QR area, hide config\n        document.getElementById('connectBtn').classList.add('hidden')\n        document.getElementById('disconnectBtn').classList.remove('hidden')\n        document.getElementById('configSection').classList.add('hidden')\n        document.getElementById('qrContainer').classList.remove('hidden')\n\n        logResult(LOCALE === 'zh' ? `Session 已创建: ${sessionId}` : `Session created: ${sessionId}`, 'info')\n        logResult(LOCALE === 'zh' ? '等待移动钱包扫码...' : 'Waiting for mobile wallet to scan...', 'info')\n\n        // Append lang/theme options to URL\n        let finalUrl = url\n        const walletLang = document.getElementById('walletLang').value\n        const walletTheme = document.getElementById('walletTheme').value\n        const urlObj = new URL(finalUrl)\n        if (walletLang) urlObj.searchParams.set('lang', walletLang)\n        if (walletTheme) urlObj.searchParams.set('theme', walletTheme)\n        finalUrl = urlObj.toString()\n\n        // Show QR code and link\n        document.getElementById('sessionUrl').textContent = finalUrl\n        const qrcodeContainer = document.getElementById('qrcode')\n        qrcodeContainer.innerHTML = ''\n        new QRCode(qrcodeContainer, {\n          text: finalUrl,\n          width: 220,\n          height: 220,\n          colorDark: '#1a1a2e',\n          colorLight: '#ffffff',\n          correctLevel: QRCode.CorrectLevel.M\n        })\n\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `连接失败: ${error.message}` : `Connection failed: ${error.message}`, 'error')\n        updateStatus('disconnected', t('demo.notConnected'))\n        document.getElementById('connectBtn').disabled = false\n      }\n    }\n\n    // Disconnect\n    window.disconnect = function() {\n      if (provider) {\n        provider.disconnect()\n        provider = null\n      }\n      document.getElementById('qrcode').innerHTML = ''\n      document.getElementById('sessionUrl').textContent = ''\n      document.getElementById('qrContainer').classList.add('hidden')\n      document.getElementById('configSection').classList.remove('hidden')\n      updateStatus('disconnected', t('demo.notConnected'))\n      document.getElementById('connectBtn').classList.remove('hidden')\n      document.getElementById('disconnectBtn').classList.add('hidden')\n      document.getElementById('connectBtn').disabled = false\n    }\n\n    // Resume existing session\n    window.resumeSession = async function() {\n      const sessionData = loadSession()\n      if (!sessionData) {\n        logResult(LOCALE === 'zh' ? '没有可恢复的会话' : 'No session to resume', 'error')\n        return\n      }\n\n      try {\n        document.getElementById('connectBtn').disabled = true\n        document.getElementById('resumeBtn')?.remove()\n        updateStatus('connecting', LOCALE === 'zh' ? '恢复连接中...' : 'Resuming connection...')\n        logResult(LOCALE === 'zh' ? `恢复 Session: ${sessionData.sessionId}` : `Resuming session: ${sessionData.sessionId}`, 'info')\n\n        provider = new RemoteProvider()\n\n        // Listen for events (same as startConnect)\n        provider.on('connect', async (info) => {\n          logResult(LOCALE === 'zh' ? `已连接，链 ID: ${info.chainId}` : `Connected, Chain ID: ${info.chainId}`, 'info')\n          updateStatus('connected', t('bridge.connected'))\n\n          document.getElementById('walletChainId').textContent = provider.chainId\n          document.getElementById('walletSession').textContent = provider.session.id\n\n          // Try to get all authorized accounts first\n          const allAccounts = await fetchAllAuthorizedAccounts()\n          if (!allAccounts) {\n            updateAccountSelector(provider.accounts)\n          }\n        })\n\n        provider.on('disconnect', (info) => {\n          logResult(LOCALE === 'zh' ? `已断开: ${info.message}` : `Disconnected: ${info.message}`, 'error')\n          updateStatus('disconnected', t('demo.notConnected'))\n\n          if (info.userInitiated || !provider || provider._reconnectAttempts >= provider._maxReconnectAttempts) {\n            document.getElementById('connectBtn').classList.remove('hidden')\n            document.getElementById('disconnectBtn').classList.add('hidden')\n            document.getElementById('connectBtn').disabled = false\n            document.getElementById('qrcode').innerHTML = ''\n            document.getElementById('sessionUrl').textContent = ''\n            document.getElementById('qrContainer').classList.add('hidden')\n            document.getElementById('configSection').classList.remove('hidden')\n          }\n        })\n\n        provider.on('reconnecting', (info) => {\n          logResult(LOCALE === 'zh' ? `正在重连... (${info.attempt}/${info.maxAttempts})` : `Reconnecting... (${info.attempt}/${info.maxAttempts})`, 'info')\n          updateStatus('connecting', LOCALE === 'zh' ? '重新连接中...' : 'Reconnecting...')\n        })\n\n        provider.on('chainChanged', (chainId) => {\n          logResult(LOCALE === 'zh' ? `链已切换: ${chainId}` : `Chain changed: ${chainId}`, 'info')\n          document.getElementById('walletChainId').textContent = chainId\n        })\n\n        provider.on('accountsChanged', (accounts) => {\n          if (accounts.length > 0) {\n            logResult(LOCALE === 'zh' ? `账户已更新，共 ${accounts.length} 个账户` : `Accounts updated, ${accounts.length} account(s)`, 'info')\n            updateAccountSelector(accounts)\n          }\n        })\n\n        await provider.resumeSession(sessionData)\n\n        // Show QR area, hide config\n        document.getElementById('connectBtn').classList.add('hidden')\n        document.getElementById('disconnectBtn').classList.remove('hidden')\n        document.getElementById('configSection').classList.add('hidden')\n        document.getElementById('qrContainer').classList.remove('hidden')\n\n        // Show QR code and link\n        let finalUrl = sessionData.sessionUrl\n        const walletLang = document.getElementById('walletLang').value\n        const walletTheme = document.getElementById('walletTheme').value\n        const urlObj = new URL(finalUrl)\n        if (walletLang) urlObj.searchParams.set('lang', walletLang)\n        if (walletTheme) urlObj.searchParams.set('theme', walletTheme)\n        finalUrl = urlObj.toString()\n\n        document.getElementById('sessionUrl').textContent = finalUrl\n        const qrcodeContainer = document.getElementById('qrcode')\n        qrcodeContainer.innerHTML = ''\n        new QRCode(qrcodeContainer, {\n          text: finalUrl,\n          width: 220,\n          height: 220,\n          colorDark: '#1a1a2e',\n          colorLight: '#ffffff',\n          correctLevel: QRCode.CorrectLevel.M\n        })\n\n        logResult(LOCALE === 'zh' ? '等待移动钱包重新连接...' : 'Waiting for mobile wallet to reconnect...', 'info')\n\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `恢复失败: ${error.message}` : `Resume failed: ${error.message}`, 'error')\n        updateStatus('disconnected', t('demo.notConnected'))\n        document.getElementById('connectBtn').disabled = false\n        clearSession()\n      }\n    }\n\n    // Check for existing session on page load\n    ;(async function checkExistingSession() {\n      const sessionData = loadSession()\n      if (sessionData) {\n        const isValid = await checkSessionValid(sessionData.sessionId)\n        if (isValid) {\n          logResult(LOCALE === 'zh' ? `发现未完成的会话: ${sessionData.sessionId}` : `Found existing session: ${sessionData.sessionId}`, 'info')\n\n          // Add resume button\n          const connectBtn = document.getElementById('connectBtn')\n          const resumeBtn = document.createElement('button')\n          resumeBtn.id = 'resumeBtn'\n          resumeBtn.className = 'btn btn-secondary'\n          resumeBtn.textContent = LOCALE === 'zh' ? '恢复连接' : 'Resume'\n          resumeBtn.onclick = resumeSession\n          connectBtn.parentNode.insertBefore(resumeBtn, connectBtn)\n\n          // Update connect button text\n          connectBtn.textContent = LOCALE === 'zh' ? '新建连接' : 'New Session'\n        } else {\n          clearSession()\n        }\n      }\n    })()\n\n    // Copy link\n    window.copySessionUrl = async function() {\n      const url = document.getElementById('sessionUrl').textContent\n      if (!url) return\n\n      try {\n        await navigator.clipboard.writeText(url)\n        const btn = document.getElementById('copyBtn')\n        btn.textContent = t('common.copied')\n        btn.classList.add('copied')\n        setTimeout(() => {\n          btn.textContent = t('common.copy')\n          btn.classList.remove('copied')\n        }, 2000)\n        logResult(LOCALE === 'zh' ? '链接已复制到剪贴板' : 'Link copied to clipboard', 'info')\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? '复制失败: ' + error.message : 'Copy failed: ' + error.message, 'error')\n      }\n    }\n\n    // Test: get accounts - tries wallet_getPermissions first for all authorized accounts\n    window.testGetAccounts = async function() {\n      try {\n        // First try wallet_getPermissions to get ALL authorized accounts\n        logResult(LOCALE === 'zh' ? '调用 wallet_getPermissions 获取所有授权账户...' : 'Calling wallet_getPermissions to get all authorized accounts...', 'info')\n\n        try {\n          const permissions = await provider.request({ method: 'wallet_getPermissions' })\n          const ethAccountsPermission = permissions.find(p => p.parentCapability === 'eth_accounts')\n\n          if (ethAccountsPermission?.caveats) {\n            const caveat = ethAccountsPermission.caveats.find(c => c.type === 'restrictReturnedAccounts')\n            if (caveat?.value && Array.isArray(caveat.value)) {\n              const allAccounts = caveat.value\n              logResult(LOCALE === 'zh' ? `所有授权账户 (${allAccounts.length}): ${JSON.stringify(allAccounts)}` : `All authorized accounts (${allAccounts.length}): ${JSON.stringify(allAccounts)}`)\n              // Update the account selector with all accounts\n              updateAccountSelector(allAccounts)\n              return\n            }\n          }\n        } catch (permError) {\n          logResult(LOCALE === 'zh' ? `wallet_getPermissions 不支持，回退到 eth_accounts` : `wallet_getPermissions not supported, falling back to eth_accounts`, 'info')\n        }\n\n        // Fallback to eth_accounts (only returns current account)\n        const accounts = await provider.request({ method: 'eth_accounts' })\n        logResult(LOCALE === 'zh' ? `当前账户: ${JSON.stringify(accounts)}` : `Current accounts: ${JSON.stringify(accounts)}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: get chain ID\n    window.testGetChainId = async function() {\n      try {\n        logResult(LOCALE === 'zh' ? '调用 eth_chainId...' : 'Calling eth_chainId...', 'info')\n        const chainId = await provider.request({ method: 'eth_chainId' })\n        logResult(LOCALE === 'zh' ? `链 ID: ${chainId} (${parseInt(chainId, 16)})` : `Chain ID: ${chainId} (${parseInt(chainId, 16)})`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: get balance\n    window.testGetBalance = async function() {\n      try {\n        const account = getCurrentAccount()\n        logResult(LOCALE === 'zh' ? `调用 eth_getBalance (${account.slice(0,8)}...)...` : `Calling eth_getBalance (${account.slice(0,8)}...)...`, 'info')\n        const balance = await provider.request({\n          method: 'eth_getBalance',\n          params: [account, 'latest'],\n        })\n        const eth = parseInt(balance, 16) / 1e18\n        logResult(LOCALE === 'zh' ? `余额: ${balance} (${eth.toFixed(6)} ETH)` : `Balance: ${balance} (${eth.toFixed(6)} ETH)`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: sign message\n    window.testPersonalSign = async function() {\n      try {\n        const account = getCurrentAccount()\n        const message = 'Hello from Remote Inject! ' + new Date().toISOString()\n        logResult(LOCALE === 'zh' ? `调用 personal_sign: \"${message}\"` : `Calling personal_sign: \"${message}\"`, 'info')\n\n        const signature = await provider.request({\n          method: 'personal_sign',\n          params: [\n            '0x' + Array.from(new TextEncoder().encode(message)).map(b => b.toString(16).padStart(2, '0')).join(''),\n            account,\n          ],\n        })\n        logResult(LOCALE === 'zh' ? `签名: ${signature}` : `Signature: ${signature}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: send transaction\n    window.testSendTransaction = async function() {\n      try {\n        const account = getCurrentAccount()\n        logResult(LOCALE === 'zh' ? '调用 eth_sendTransaction (发送 0 ETH 到自己)...' : 'Calling eth_sendTransaction (sending 0 ETH to self)...', 'info')\n\n        const txHash = await provider.request({\n          method: 'eth_sendTransaction',\n          params: [{\n            from: account,\n            to: account,\n            value: '0x0',\n          }],\n        })\n        logResult(LOCALE === 'zh' ? `交易哈希: ${txHash}` : `Transaction hash: ${txHash}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: switch chain\n    window.testSwitchChain = async function() {\n      try {\n        const chainSelect = document.getElementById('chainSelect')\n        const targetChainId = chainSelect.value\n        const chainName = chainSelect.options[chainSelect.selectedIndex].text\n\n        logResult(LOCALE === 'zh' ? `调用 wallet_switchEthereumChain: ${chainName}...` : `Calling wallet_switchEthereumChain: ${chainName}...`, 'info')\n\n        await provider.request({\n          method: 'wallet_switchEthereumChain',\n          params: [{ chainId: targetChainId }],\n        })\n        logResult(LOCALE === 'zh' ? `已切换到: ${chainName}` : `Switched to: ${chainName}`)\n      } catch (error) {\n        // Error 4902 means chain not added, try to add it\n        if (error.code === 4902) {\n          logResult(LOCALE === 'zh' ? '钱包中未添加此链，请先在钱包中添加' : 'Chain not added in wallet, please add it first', 'error')\n        } else {\n          logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n        }\n      }\n    }\n\n    // Test: request accounts (re-request authorization)\n    window.testRequestAccounts = async function() {\n      try {\n        logResult(LOCALE === 'zh' ? '调用 eth_requestAccounts...' : 'Calling eth_requestAccounts...', 'info')\n        const accounts = await provider.request({ method: 'eth_requestAccounts' })\n        logResult(LOCALE === 'zh' ? `授权账户: ${JSON.stringify(accounts)}` : `Authorized accounts: ${JSON.stringify(accounts)}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: EIP-712 typed data signature\n    window.testSignTypedData = async function() {\n      try {\n        const account = getCurrentAccount()\n        const chainId = parseInt(provider.chainId, 16)\n        const typedData = {\n          types: {\n            EIP712Domain: [\n              { name: 'name', type: 'string' },\n              { name: 'version', type: 'string' },\n              { name: 'chainId', type: 'uint256' },\n              { name: 'verifyingContract', type: 'address' },\n            ],\n            Person: [\n              { name: 'name', type: 'string' },\n              { name: 'wallet', type: 'address' },\n            ],\n            Mail: [\n              { name: 'from', type: 'Person' },\n              { name: 'to', type: 'Person' },\n              { name: 'contents', type: 'string' },\n            ],\n          },\n          primaryType: 'Mail',\n          domain: {\n            name: 'Remote Inject Demo',\n            version: '1',\n            chainId: chainId,\n            verifyingContract: '0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC',\n          },\n          message: {\n            from: {\n              name: 'Alice',\n              wallet: account,\n            },\n            to: {\n              name: 'Bob',\n              wallet: '0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB',\n            },\n            contents: 'Hello, Bob! Time: ' + new Date().toISOString(),\n          },\n        }\n\n        logResult(LOCALE === 'zh' ? '调用 eth_signTypedData_v4 (EIP-712)...' : 'Calling eth_signTypedData_v4 (EIP-712)...', 'info')\n\n        const signature = await provider.request({\n          method: 'eth_signTypedData_v4',\n          params: [account, JSON.stringify(typedData)],\n        })\n        logResult(LOCALE === 'zh' ? `EIP-712 签名: ${signature}` : `EIP-712 Signature: ${signature}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: get block number\n    window.testGetBlockNumber = async function() {\n      try {\n        logResult(LOCALE === 'zh' ? '调用 eth_blockNumber...' : 'Calling eth_blockNumber...', 'info')\n        const blockNumber = await provider.request({ method: 'eth_blockNumber' })\n        logResult(LOCALE === 'zh' ? `区块高度: ${blockNumber} (${parseInt(blockNumber, 16)})` : `Block number: ${blockNumber} (${parseInt(blockNumber, 16)})`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: read contract (eth_call) - read USDC decimals on current chain\n    window.testReadContract = async function() {\n      try {\n        // Common USDC contract addresses on different chains\n        const usdcAddresses = {\n          '0x1': '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', // Ethereum\n          '0x89': '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', // Polygon\n          '0xa4b1': '0xaf88d065e77c8cC2239327C5EDb3A432268e5831', // Arbitrum\n          '0xa': '0x0b2C639c533813f4Aa9D7837CAf62653d097Ff85', // Optimism\n          '0x38': '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d', // BSC\n          '0xa86a': '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E', // Avalanche\n          '0x2105': '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // Base\n        }\n\n        const chainId = provider.chainId\n        const usdcAddress = usdcAddresses[chainId]\n\n        if (!usdcAddress) {\n          logResult(LOCALE === 'zh' ? `当前链 (${chainId}) 无预设 USDC 合约地址，使用 ETH name() 调用示例` : `Current chain (${chainId}) has no preset USDC address, using ETH name() call example`, 'info')\n          // Try calling a simple function - name() on WETH (most chains have it)\n          return\n        }\n\n        // decimals() function selector: 0x313ce567\n        const data = '0x313ce567'\n\n        logResult(LOCALE === 'zh' ? `调用 eth_call: USDC decimals() on ${chainId}...` : `Calling eth_call: USDC decimals() on ${chainId}...`, 'info')\n\n        const result = await provider.request({\n          method: 'eth_call',\n          params: [{\n            to: usdcAddress,\n            data: data,\n          }, 'latest'],\n        })\n\n        const decimals = parseInt(result, 16)\n        logResult(LOCALE === 'zh' ? `USDC decimals: ${decimals}` : `USDC decimals: ${decimals}`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n\n    // Test: estimate gas\n    window.testEstimateGas = async function() {\n      try {\n        const account = getCurrentAccount()\n        logResult(LOCALE === 'zh' ? '调用 eth_estimateGas (估算发送 0 ETH)...' : 'Calling eth_estimateGas (estimate sending 0 ETH)...', 'info')\n\n        const gasEstimate = await provider.request({\n          method: 'eth_estimateGas',\n          params: [{\n            from: account,\n            to: account,\n            value: '0x0',\n          }],\n        })\n\n        const gasNumber = parseInt(gasEstimate, 16)\n        logResult(LOCALE === 'zh' ? `Gas 估算: ${gasEstimate} (${gasNumber})` : `Gas estimate: ${gasEstimate} (${gasNumber})`)\n      } catch (error) {\n        logResult(LOCALE === 'zh' ? `错误: ${error.message}` : `Error: ${error.message}`, 'error')\n      }\n    }\n  </script>\n</body>\n</html>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/top-controls.eta": {
    content: "<div class=\"top-controls\">\n  <button class=\"ctrl-btn\" id=\"theme-toggle\" title=\"Toggle theme\">\n    <span id=\"theme-icon\">🌙</span>\n  </button>\n  <% if (it.availableLocales && it.availableLocales.length > 1) { %>\n  <select class=\"ctrl-btn lang\" id=\"lang-select\">\n    <% it.availableLocales.forEach(function(loc) { %>\n    <option value=\"<%= loc %>\" <%= loc === it.locale ? 'selected' : '' %>><%= loc.toUpperCase() %></option>\n    <% }) %>\n  </select>\n  <% } %>\n</div>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/footer.eta": {
    content: "<footer class=\"brand-footer\">\n  <a href=\"https://github.com/nicepkg/remote-inject\" target=\"_blank\" rel=\"noopener\">Remote Inject</a>\n</footer>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/head.eta": {
    content: "<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<link rel=\"icon\" type=\"image/svg+xml\" href=\"/logo.svg\">\n<link rel=\"stylesheet\" href=\"/css/theme.css\">\n<link rel=\"stylesheet\" href=\"/css/base.css\">\n<% if (it.hasCustomTheme) { %>\n<link rel=\"stylesheet\" href=\"/css/custom-theme.css\">\n<% } %>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/i18n-init.eta": {
    content: "<script>\nwindow.LOCALE = '<%= it.locale %>';\nwindow.TRANSLATIONS = <%~ it.translationsJson %>;\nfunction t(key, params) {\n  var text = window.TRANSLATIONS[key] || key;\n  if (params) {\n    Object.keys(params).forEach(function(k) {\n      text = text.replace(new RegExp('\\\\{' + k + '\\\\}', 'g'), params[k]);\n    });\n  }\n  return text;\n}\n</script>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/lang-controls.eta": {
    content: "<script>\n(function() {\n  var langSelect = document.getElementById('lang-select');\n  if (!langSelect) return;\n\n  langSelect.addEventListener('change', function() {\n    var locale = this.value;\n    document.cookie = 'locale=' + locale + ';path=/;max-age=31536000';\n    // Reload page to apply new language\n    var url = new URL(window.location.href);\n    url.searchParams.set('lang', locale);\n    window.location.href = url.toString();\n  });\n})();\n</script>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/dapp-info.eta": {
    content: "<% if (it.dapp) { %>\n<div class=\"dapp-info\">\n  <div class=\"dapp-icon\">\n    <% if (it.dapp.icon) { %>\n    <img src=\"<%= it.dapp.icon %>\" alt=\"\" onerror=\"this.style.display='none';this.parentNode.textContent='🔗'\">\n    <% } else { %>\n    🔗\n    <% } %>\n  </div>\n  <div class=\"dapp-text\">\n    <div class=\"dapp-name\"><%= it.dapp.name || it.t('bridge.unknownApp') %></div>\n    <div class=\"dapp-url\"><%= it.dapp.host %></div>\n  </div>\n</div>\n<% } %>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/theme-controls.eta": {
    content: "<script>\n(function() {\n  var themeToggle = document.getElementById('theme-toggle');\n  var themeIcon = document.getElementById('theme-icon');\n\n  function updateIcon() {\n    var theme = document.documentElement.getAttribute('data-theme');\n    themeIcon.textContent = theme === 'dark' ? '☀️' : '🌙';\n  }\n\n  updateIcon();\n\n  themeToggle.addEventListener('click', function() {\n    var current = document.documentElement.getAttribute('data-theme');\n    var next = current === 'dark' ? 'light' : 'dark';\n    document.documentElement.setAttribute('data-theme', next);\n    localStorage.setItem('theme', next);\n    document.cookie = 'theme=' + next + ';path=/;max-age=31536000';\n    updateIcon();\n  });\n})();\n</script>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/partials/theme-init.eta": {
    content: "<script>\n(function() {\n  // Check server-forced theme first\n  var serverTheme = '<%= it.theme || \"\" %>';\n  if (serverTheme) {\n    document.documentElement.setAttribute('data-theme', serverTheme);\n    return;\n  }\n  // Check saved preference\n  var saved = localStorage.getItem('theme');\n  if (saved === 'dark' || saved === 'light') {\n    document.documentElement.setAttribute('data-theme', saved);\n    return;\n  }\n  // Use system preference\n  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n    document.documentElement.setAttribute('data-theme', 'dark');\n  } else {\n    document.documentElement.setAttribute('data-theme', 'light');\n  }\n})();\n</script>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  },
  "/templates/bridge.eta": {
    content: "<!DOCTYPE html>\n<html lang=\"<%= it.locale %>\"<% if (it.theme) { %> data-theme=\"<%= it.theme %>\"<% } %>>\n<head>\n  <%~ include('partials/head', it) %>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n  <title><%= it.t('bridge.title') %></title>\n  <style>\n    /* Bridge page specific styles */\n    body {\n      background: var(--color-accent-gradient);\n      min-height: 100vh;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n    }\n\n    .container {\n      background: var(--color-bg-secondary);\n      border-radius: var(--radius-xl);\n      padding: 24px 20px;\n      max-width: 340px;\n      width: 100%;\n      text-align: center;\n      box-shadow: var(--shadow-elevated);\n    }\n\n    .dapp-icon {\n      width: 44px;\n      height: 44px;\n      border-radius: 10px;\n    }\n\n    .dapp-url {\n      font-size: 12px;\n    }\n\n    /* Status area */\n    .status-area {\n      padding: 16px 0;\n      margin-bottom: 16px;\n    }\n\n    .status-icon {\n      width: 56px;\n      height: 56px;\n      margin: 0 auto 12px;\n      position: relative;\n    }\n\n    .status-icon svg {\n      width: 56px;\n      height: 56px;\n    }\n\n    .status-title {\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--color-text-primary);\n      margin-bottom: 4px;\n    }\n\n    .status-desc {\n      font-size: 13px;\n      color: var(--color-text-secondary);\n    }\n\n    /* Request type tag */\n    .request-type {\n      display: inline-block;\n      padding: 4px 12px;\n      background: var(--color-warning-bg);\n      color: var(--color-warning);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      margin-top: 8px;\n    }\n\n    .wallet-info {\n      margin-bottom: 16px;\n    }\n\n    /* Buttons */\n    .btn {\n      width: 100%;\n    }\n\n    /* Hint text */\n    .hint {\n      margin-top: 12px;\n      font-size: 11px;\n      color: var(--color-text-muted);\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <!-- Error state -->\n    <div id=\"errorView\" class=\"error-container hidden\">\n      <div class=\"error-icon\"></div>\n      <div class=\"error-title\" id=\"errorTitle\"><%= it.t('bridge.error') %></div>\n      <div class=\"error-desc\" id=\"errorDesc\"><%= it.t('bridge.reconnect') %></div>\n    </div>\n\n    <!-- Main view -->\n    <div id=\"mainView\">\n      <!-- DApp info - compact horizontal -->\n      <div class=\"dapp-info\">\n        <div class=\"dapp-icon\" id=\"dappIcon\"><% if (it.dapp?.icon) { %>\n          <img src=\"<%= it.dapp.icon %>\" alt=\"\" onerror=\"this.parentElement.textContent='<%= (it.dapp.name || '?')[0].toUpperCase() %>'\">\n        <% } else { %><%= (it.dapp?.name || '?')[0].toUpperCase() %><% } %></div>\n        <div class=\"dapp-text\">\n          <div class=\"dapp-name\" id=\"dappName\"><%= it.dapp?.name || it.t('bridge.unknownApp') %></div>\n          <div class=\"dapp-url\" id=\"dappUrl\"><%= it.dapp?.host || '-' %></div>\n        </div>\n      </div>\n\n      <!-- Status area -->\n      <div class=\"status-area\">\n        <div class=\"status-icon\" id=\"statusIcon\">\n          <div class=\"loading-ring\"></div>\n        </div>\n        <div class=\"status-title\" id=\"statusTitle\"><%= it.t('bridge.connecting') %></div>\n        <div class=\"status-desc\" id=\"statusDesc\"><%= it.t('bridge.pleaseWait') %></div>\n        <div class=\"request-type hidden\" id=\"requestType\"></div>\n      </div>\n\n      <!-- Wallet info -->\n      <div class=\"wallet-info hidden\" id=\"walletInfo\">\n        <div class=\"wallet-row\">\n          <span class=\"wallet-label\"><%= it.t('bridge.wallet') %></span>\n          <span class=\"wallet-value\" id=\"walletName\">-</span>\n        </div>\n        <div class=\"wallet-row\">\n          <span class=\"wallet-label\"><%= it.t('bridge.address') %></span>\n          <span class=\"wallet-value\" id=\"walletAddress\">-</span>\n        </div>\n        <div class=\"wallet-row\">\n          <span class=\"wallet-label\"><%= it.t('bridge.network') %></span>\n          <span class=\"wallet-value\" id=\"walletNetwork\">-</span>\n        </div>\n      </div>\n\n      <!-- Disconnect button -->\n      <button class=\"btn btn-disconnect hidden\" id=\"disconnectBtn\" onclick=\"disconnect()\">\n        <%= it.t('bridge.disconnect') %>\n      </button>\n\n      <div class=\"hint\" id=\"hint\"><%= it.t('bridge.keepOpen') %></div>\n    </div>\n  </div>\n\n  <!-- i18n data -->\n  <script type=\"application/json\" id=\"i18n-data\"><%~ it.translationsJson %></script>\n\n  <script>\n    // Server-injected data\n    const SESSION_ID = '<%= it.sessionId %>'\n    const SECRET = '<%= it.secret %>'\n    const LOCALE = '<%= it.locale %>'\n\n    // Safe App iframe detection\n    function isSafeAppIframe() {\n      try {\n        return window.parent !== window && window.self !== window.top\n      } catch (e) {\n        return true // Cross-origin iframe\n      }\n    }\n\n    // Apply stored params for Safe App iframe (where URL params might be lost during navigation)\n    // Tries multiple sources: URL hash, localStorage, sessionStorage\n    (function() {\n      if (!isSafeAppIframe()) return // Only apply in Safe App iframe environment\n\n      try {\n        let lang = null, theme = null\n\n        // Source 1: URL hash (most reliable for Safe App)\n        const hash = window.location.hash\n        if (hash && hash.startsWith('#ri=')) {\n          try {\n            const hashData = JSON.parse(decodeURIComponent(hash.slice(4)))\n            lang = hashData.lang\n            theme = hashData.theme\n            console.log('[Bridge] Recovered params from URL hash:', { lang, theme })\n          } catch (e) {}\n        }\n\n        // Source 2: localStorage (backup)\n        if (!lang && !theme) {\n          try {\n            const stored = localStorage.getItem('ri_bridge_params')\n            if (stored) {\n              const data = JSON.parse(stored)\n              // Only use if stored recently (within 5 minutes)\n              if (data.ts && Date.now() - data.ts < 300000) {\n                lang = data.lang\n                theme = data.theme\n                console.log('[Bridge] Recovered params from localStorage:', { lang, theme })\n              }\n              localStorage.removeItem('ri_bridge_params') // Clean up\n            }\n          } catch (e) {}\n        }\n\n        // Source 3: sessionStorage (legacy fallback)\n        if (!lang && !theme) {\n          try {\n            const stored = sessionStorage.getItem('ri_bridge_params')\n            if (stored) {\n              const data = JSON.parse(stored)\n              lang = data.lang\n              theme = data.theme\n              sessionStorage.removeItem('ri_bridge_params')\n              console.log('[Bridge] Recovered params from sessionStorage:', { lang, theme })\n            }\n          } catch (e) {}\n        }\n\n        if (!lang && !theme) return\n\n        // Check current URL params\n        const currentUrl = new URL(window.location.href)\n        const urlLang = currentUrl.searchParams.get('lang')\n        const urlTheme = currentUrl.searchParams.get('theme')\n\n        // If params differ, reload with correct params (and clean hash)\n        if ((lang && lang !== urlLang) || (theme && theme !== urlTheme)) {\n          if (lang) currentUrl.searchParams.set('lang', lang)\n          if (theme) currentUrl.searchParams.set('theme', theme)\n          currentUrl.hash = '' // Remove hash after reading\n          console.log('[Bridge] Reloading with correct params:', currentUrl.toString())\n          window.location.replace(currentUrl.toString())\n          return\n        }\n\n        // Apply theme immediately if present (in case SSR didn't catch it)\n        if (theme && (theme === 'dark' || theme === 'light')) {\n          document.documentElement.setAttribute('data-theme', theme)\n        }\n      } catch (e) {\n        console.log('[Bridge] Error recovering params:', e)\n      }\n    })();\n\n    // i18n translations (from server)\n    const I18N = JSON.parse(document.getElementById('i18n-data').textContent)\n\n    // Translate function\n    function t(key, params = {}) {\n      let text = I18N[key] || key\n      Object.entries(params).forEach(([k, v]) => {\n        text = text.replace(new RegExp(`\\\\{${k}\\\\}`, 'g'), v)\n      })\n      return text\n    }\n\n    // Chain ID to name mapping\n    const CHAIN_NAMES = {\n      1: 'Ethereum',\n      5: 'Goerli',\n      11155111: 'Sepolia',\n      137: 'Polygon',\n      80001: 'Mumbai',\n      56: 'BNB Chain',\n      97: 'BNB Testnet',\n      42161: 'Arbitrum',\n      10: 'Optimism',\n      43114: 'Avalanche',\n      250: 'Fantom',\n      8453: 'Base',\n    }\n\n    // Security: validate image URL (prevent XSS)\n    function isValidImageUrl(url) {\n      if (!url || typeof url !== 'string') return false\n      if (url.startsWith('data:image/')) return true\n      try {\n        const parsed = new URL(url)\n        return parsed.protocol === 'http:' || parsed.protocol === 'https:'\n      } catch {\n        return false\n      }\n    }\n\n    let ws = null\n    let currentAddress = null\n    let currentChainId = null\n    let pendingRequestCount = 0\n    let selectedProvider = null\n    let providerName = null\n    let userInitiatedDisconnect = false\n    let reconnectAttempts = 0\n    const maxReconnectAttempts = 5\n    const reconnectDelay = 1000\n\n    // EIP-6963 wallet discovery\n    const eip6963Providers = []\n\n    window.addEventListener('eip6963:announceProvider', (event) => {\n      const { info, provider } = event.detail\n      if (!eip6963Providers.find(p => p.info.uuid === info.uuid)) {\n        eip6963Providers.push({ info, provider })\n        console.log('[Bridge] EIP-6963 discovered wallet:', info.name)\n      }\n    })\n\n    window.dispatchEvent(new Event('eip6963:requestProvider'))\n\n    // Check if running in Safe App iframe\n    function isSafeAppEnvironment() {\n      try {\n        // Safe Apps always run in an iframe\n        if (window.parent === window || window.self === window.top) {\n          return false\n        }\n        // Additional check: Safe sets specific properties\n        return true\n      } catch (e) {\n        // Cross-origin iframe access error - likely Safe or similar\n        return true\n      }\n    }\n\n    // Create Safe Apps Provider using ESM dynamic imports\n    async function createSafeProvider() {\n      try {\n        console.log('[Bridge] Loading Safe Apps SDK via ESM...')\n\n        // Dynamically import Safe Apps SDK and Provider from esm.sh\n        const [sdkModule, providerModule] = await Promise.all([\n          import('https://esm.sh/@safe-global/safe-apps-sdk@9.1.0'),\n          import('https://esm.sh/@safe-global/safe-apps-provider@0.18.6')\n        ])\n\n        console.log('[Bridge] SDK module loaded:', sdkModule)\n        console.log('[Bridge] Provider module loaded:', providerModule)\n\n        const SafeAppsSDK = sdkModule.default || sdkModule.SafeAppsSDK\n        const SafeAppProvider = providerModule.SafeAppProvider || providerModule.default\n\n        if (!SafeAppsSDK || !SafeAppProvider) {\n          console.log('[Bridge] Safe Apps SDK modules not properly loaded')\n          return null\n        }\n\n        console.log('[Bridge] Creating Safe SDK instance...')\n        const sdk = new SafeAppsSDK()\n\n        // Try to get Safe info to confirm we're in Safe\n        console.log('[Bridge] Getting Safe info...')\n        const safeInfo = await Promise.race([\n          sdk.safe.getInfo(),\n          new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 5000))\n        ])\n\n        console.log('[Bridge] Safe info received:', safeInfo)\n\n        if (safeInfo && safeInfo.safeAddress) {\n          console.log('[Bridge] Safe detected:', safeInfo.safeAddress)\n          const provider = new SafeAppProvider(safeInfo, sdk)\n          return { provider, name: 'Safe', safeInfo }\n        }\n      } catch (e) {\n        console.log('[Bridge] Not in Safe environment or error:', e.message, e)\n      }\n      return null\n    }\n\n    // Get wallet name for a provider\n    function getWalletName(provider) {\n      if (!provider) return t('bridge.unknownApp')\n      // Safe Wallet detection\n      if (provider.isSafe || provider.isSafeWallet) return 'Safe'\n      if (provider.isTokenPocket) return 'TokenPocket'\n      if (provider.isTrust) return 'Trust Wallet'\n      if (provider.isImToken) return 'imToken'\n      if (provider.isMathWallet) return 'Math Wallet'\n      if (provider.isBitKeep || provider.isBitget) return 'Bitget Wallet'\n      if (provider.isOKExWallet || provider.isOkxWallet) return 'OKX Wallet'\n      if (provider.isCoinbaseWallet) return 'Coinbase Wallet'\n      if (provider.isRainbow) return 'Rainbow'\n      if (provider.isMetaMask && !provider.isBraveWallet) return 'MetaMask'\n      if (provider.isBraveWallet) return 'Brave Wallet'\n      if (provider.isPhantom) return 'Phantom'\n      if (provider.isOneInch) return '1inch Wallet'\n      // Kraken Wallet detection\n      if (provider.isKraken) return 'Kraken Wallet'\n      return t('bridge.wallet')\n    }\n\n    // Detect and select provider with retry mechanism for mobile wallets\n    async function detectProvider() {\n      // First, check if we're in a Safe App environment\n      if (isSafeAppEnvironment()) {\n        console.log('[Bridge] Detected iframe environment, trying Safe Apps Provider...')\n\n        // In iframe (Safe App), ONLY try Safe Provider - don't fall back to other wallets\n        // Wait a bit for SDK to load\n        await new Promise(resolve => setTimeout(resolve, 500))\n\n        const safeResult = await createSafeProvider()\n        if (safeResult) {\n          return safeResult\n        }\n\n        // If Safe Provider failed in iframe, return null with specific error\n        // Don't try to detect other wallets (like Phantom browser extension)\n        console.log('[Bridge] Safe Apps Provider failed in iframe environment')\n        return { provider: null, name: null, isSafeError: true }\n      }\n\n      const maxRetries = 10\n      const retryDelay = 300  // 300ms between retries\n\n      let walletSelection = null\n      try {\n        const stored = sessionStorage.getItem('selectedWallet')\n        if (stored) {\n          walletSelection = JSON.parse(stored)\n          sessionStorage.removeItem('selectedWallet')\n        }\n      } catch (e) {\n        console.error('[Bridge] Failed to read wallet selection:', e)\n      }\n\n      for (let attempt = 0; attempt < maxRetries; attempt++) {\n        await new Promise(resolve => setTimeout(resolve, retryDelay))\n\n        // Re-dispatch EIP-6963 request on each attempt\n        window.dispatchEvent(new Event('eip6963:requestProvider'))\n\n        // Try to find provider based on selection\n        if (walletSelection?.source === 'eip6963' && walletSelection.uuid) {\n          const found = eip6963Providers.find(p => p.info.uuid === walletSelection.uuid)\n          if (found) {\n            return { provider: found.provider, name: found.info.name }\n          }\n          if (walletSelection.index < eip6963Providers.length) {\n            const p = eip6963Providers[walletSelection.index]\n            return { provider: p.provider, name: p.info.name }\n          }\n        }\n\n        if (eip6963Providers.length > 0) {\n          const p = eip6963Providers[0]\n          return { provider: p.provider, name: p.info.name }\n        }\n\n        const ethereum = window.ethereum\n        if (ethereum) {\n          if (ethereum.providers && Array.isArray(ethereum.providers) && ethereum.providers.length > 0) {\n            const idx = walletSelection?.index ?? 0\n            if (idx >= 0 && idx < ethereum.providers.length) {\n              const provider = ethereum.providers[idx]\n              return { provider, name: getWalletName(provider) }\n            }\n            return { provider: ethereum.providers[0], name: getWalletName(ethereum.providers[0]) }\n          }\n          return { provider: ethereum, name: getWalletName(ethereum) }\n        }\n\n        console.log('[Bridge] No wallet found, retrying... attempt', attempt + 1)\n      }\n\n      console.log('[Bridge] No wallet detected after', maxRetries, 'attempts')\n      return { provider: null, name: null }\n    }\n\n    // Show error\n    function showError(title, desc) {\n      document.getElementById('mainView').classList.add('hidden')\n      document.getElementById('errorView').classList.remove('hidden')\n      document.getElementById('errorTitle').textContent = title\n      document.getElementById('errorDesc').textContent = desc\n    }\n\n    // Update status display\n    function updateStatus(icon, title, desc, showRequest = false) {\n      const iconEl = document.getElementById('statusIcon')\n      document.getElementById('statusTitle').textContent = title\n      document.getElementById('statusDesc').textContent = desc\n\n      if (icon === 'loading') {\n        iconEl.innerHTML = '<div class=\"loading-ring\"></div>'\n      } else if (icon === 'connected') {\n        iconEl.innerHTML = `\n          <svg viewBox=\"0 0 56 56\" fill=\"none\">\n            <circle cx=\"28\" cy=\"28\" r=\"26\" fill=\"var(--color-success-bg)\"/>\n            <path d=\"M18 28l7 7 13-13\" stroke=\"var(--color-success)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        `\n      } else if (icon === 'pending') {\n        iconEl.innerHTML = `\n          <div class=\"pulse-ring\"></div>\n          <svg viewBox=\"0 0 56 56\" fill=\"none\">\n            <circle cx=\"28\" cy=\"28\" r=\"26\" fill=\"var(--color-warning-bg)\"/>\n            <path d=\"M28 16v14l9 6\" stroke=\"var(--color-warning)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        `\n      }\n\n      document.getElementById('requestType').classList.toggle('hidden', !showRequest)\n    }\n\n    // Format address\n    function formatAddress(addr) {\n      return addr.slice(0, 6) + '...' + addr.slice(-4)\n    }\n\n    // Get chain name\n    function getChainName(chainId) {\n      return CHAIN_NAMES[chainId] || `Chain ${chainId}`\n    }\n\n    // Disconnect\n    function disconnect() {\n      userInitiatedDisconnect = true  // Mark as user-initiated\n      if (ws) {\n        try {\n          ws.send(JSON.stringify({ type: 'disconnect', reason: 'User initiated' }))\n        } catch (e) {}\n        ws.close()\n      }\n      showError(t('bridge.disconnected'), t('bridge.userDisconnected'))\n    }\n\n    // Initialize\n    async function init() {\n      userInitiatedDisconnect = false\n      reconnectAttempts = 0\n\n      if (!SESSION_ID || !SECRET) {\n        showError(t('bridge.invalidLink'), t('bridge.sessionExpired'))\n        return\n      }\n\n      const detected = await detectProvider()\n      selectedProvider = detected.provider\n      providerName = detected.name\n\n      if (!selectedProvider) {\n        if (detected.isSafeError) {\n          // Safe App environment but Safe Provider failed\n          showError(t('bridge.safeWalletFailed'), t('bridge.safeWalletOpenInApps'))\n        } else {\n          showError(t('bridge.noWallet'), t('bridge.noWallet'))\n        }\n        return\n      }\n\n      console.log(`[Bridge] Using wallet: ${providerName}`)\n\n      try {\n        updateStatus('loading', t('bridge.connectingWallet', { name: providerName }), t('bridge.authorizeInPopup'))\n\n        // For Safe Apps Provider, we may already have the address from safeInfo\n        if (detected.safeInfo) {\n          currentAddress = detected.safeInfo.safeAddress\n          currentChainId = detected.safeInfo.chainId\n          console.log('[Bridge] Using Safe address:', currentAddress, 'chainId:', currentChainId)\n        } else {\n          const accounts = await selectedProvider.request({ method: 'eth_requestAccounts' })\n          if (!accounts || accounts.length === 0) {\n            showError(t('bridge.error'), t('bridge.noAccount'))\n            return\n          }\n          currentAddress = accounts[0]\n\n          const chainId = await selectedProvider.request({ method: 'eth_chainId' })\n          currentChainId = parseInt(chainId, 16)\n        }\n\n        document.getElementById('walletName').textContent = providerName\n        document.getElementById('walletAddress').textContent = formatAddress(currentAddress)\n        document.getElementById('walletNetwork').textContent = getChainName(currentChainId)\n\n        updateStatus('loading', t('bridge.connectingApp'), t('bridge.almostDone'))\n\n        connectWebSocket()\n\n        // Safe Apps Provider may not support event listeners in the same way\n        if (selectedProvider.on) {\n          selectedProvider.on('chainChanged', (chainId) => {\n            currentChainId = parseInt(chainId, 16)\n            document.getElementById('walletNetwork').textContent = getChainName(currentChainId)\n\n            if (ws && ws.readyState === WebSocket.OPEN) {\n              ws.send(JSON.stringify({ type: 'chainChanged', chainId: currentChainId }))\n            }\n          })\n\n          selectedProvider.on('accountsChanged', (accounts) => {\n            if (accounts.length === 0) {\n              disconnect()\n              return\n            }\n            currentAddress = accounts[0]\n            document.getElementById('walletAddress').textContent = formatAddress(currentAddress)\n\n            if (ws && ws.readyState === WebSocket.OPEN) {\n              ws.send(JSON.stringify({ type: 'accountsChanged', accounts }))\n            }\n          })\n        }\n\n      } catch (error) {\n        showError(t('bridge.error'), error.message || t('common.retry'))\n      }\n    }\n\n    // Connect WebSocket\n    async function connectWebSocket() {\n      // Check if session still exists (with retry for network errors)\n      let sessionValid = false\n      let sessionCheckFailed = false\n\n      for (let checkAttempt = 0; checkAttempt < 3; checkAttempt++) {\n        try {\n          const checkRes = await fetch(`/session/${SESSION_ID}`)\n          if (checkRes.ok) {\n            sessionValid = true\n            break\n          } else if (checkRes.status === 404 || checkRes.status === 410) {\n            // 404: Session doesn't exist, 410: Session terminated - no point retrying\n            sessionCheckFailed = true\n            console.log(`[Bridge] Session unavailable (${checkRes.status})`)\n            break\n          }\n          // Other HTTP errors - retry\n          console.log(`[Bridge] Session check failed with status ${checkRes.status}, retrying...`)\n        } catch (e) {\n          // Network error - retry\n          console.log(`[Bridge] Session check network error (attempt ${checkAttempt + 1}/3):`, e.message)\n        }\n        if (checkAttempt < 2) {\n          await new Promise(r => setTimeout(r, 500 * (checkAttempt + 1)))\n        }\n      }\n\n      // Show error if session is not available (404 or 410)\n      // For network errors, let WebSocket connection attempt handle it\n      if (sessionCheckFailed) {\n        showError(t('bridge.error'), t('bridge.sessionExpired'))\n        return\n      }\n\n      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n      const wsUrl = `${protocol}//${window.location.host}/ws?session=${SESSION_ID}&role=mobile&k=${SECRET}`\n\n      ws = new WebSocket(wsUrl)\n\n      ws.onopen = () => {\n        reconnectAttempts = 0  // Reset on successful connection\n        console.log('[Bridge] WebSocket connected')\n      }\n\n      ws.onmessage = async (event) => {\n        try {\n          const message = JSON.parse(event.data)\n\n          switch (message.type) {\n            case 'ready':\n              ws.send(JSON.stringify({\n                type: 'connect',\n                address: currentAddress,\n                chainId: currentChainId,\n              }))\n\n              updateStatus('connected', t('bridge.connected'), t('bridge.waitingRequest'))\n              document.getElementById('walletInfo').classList.remove('hidden')\n              document.getElementById('disconnectBtn').classList.remove('hidden')\n              break\n\n            case 'request':\n              await handleRequest(message)\n              break\n\n            case 'disconnect':\n              userInitiatedDisconnect = true  // DApp initiated disconnect\n              showError(t('bridge.disconnected'), t('bridge.peerDisconnected'))\n              break\n\n            case 'dapp_reconnected':\n              // DApp reconnected (e.g., page refresh), resend current state\n              console.log('[Bridge] DApp reconnected, resending connect message')\n              ws.send(JSON.stringify({\n                type: 'connect',\n                address: currentAddress,\n                chainId: currentChainId,\n              }))\n              break\n          }\n        } catch (error) {\n          console.error('Message handling failed:', error)\n        }\n      }\n\n      ws.onclose = (event) => {\n        if (document.getElementById('mainView').classList.contains('hidden')) return\n\n        // Don't reconnect if user or peer initiated disconnect\n        if (userInitiatedDisconnect) {\n          showError(t('bridge.disconnected'), t('bridge.reconnect'))\n          return\n        }\n\n        // 1008 means session rejected/terminated - don't retry\n        if (event.code === 1008) {\n          console.log('[Bridge] Session rejected (1008), not retrying')\n          showError(t('bridge.error'), t('bridge.sessionExpired'))\n          return\n        }\n\n        // Try to reconnect for network issues (only for non-fatal errors)\n        if (reconnectAttempts < maxReconnectAttempts) {\n          reconnectAttempts++\n          const delay = reconnectDelay * Math.pow(1.5, reconnectAttempts - 1)\n          console.log(`[Bridge] Connection lost, reconnecting in ${delay}ms (attempt ${reconnectAttempts}/${maxReconnectAttempts})`)\n\n          updateStatus('loading',\n            t('bridge.reconnecting', { attempt: reconnectAttempts, maxAttempts: maxReconnectAttempts }),\n            t('bridge.networkDisconnected')\n          )\n\n          setTimeout(() => {\n            if (!userInitiatedDisconnect) {\n              connectWebSocket()\n            }\n          }, delay)\n        } else {\n          // Max reconnects reached\n          showError(t('bridge.disconnected'), t('bridge.reconnect'))\n        }\n      }\n\n      ws.onerror = () => {\n        // Only show error if not reconnecting\n        if (reconnectAttempts >= maxReconnectAttempts) {\n          showError(t('bridge.error'), t('bridge.connectionFailed'))\n        }\n      }\n    }\n\n    // Handle RPC request\n    async function handleRequest(message) {\n      const { id, method, params } = message\n\n      const methodName = I18N['method.' + method] || method\n      updateStatus('pending', t('bridge.confirmInWallet'), t('bridge.requestingAction'), true)\n      document.getElementById('requestType').textContent = methodName\n      pendingRequestCount++\n\n      try {\n        const result = await selectedProvider.request({ method, params })\n        ws.send(JSON.stringify({ type: 'response', id, result }))\n      } catch (error) {\n        ws.send(JSON.stringify({\n          type: 'response',\n          id,\n          error: { code: error.code || -32603, message: error.message || 'Unknown error' },\n        }))\n      }\n\n      pendingRequestCount--\n\n      if (pendingRequestCount === 0) {\n        updateStatus('connected', t('bridge.connected'), t('bridge.waitingRequest'))\n      }\n    }\n\n    // Start\n    init()\n  </script>\n\n  <%~ include('partials/footer', it) %>\n</body>\n</html>\n",
    mimeType: "application/octet-stream",
    isBase64: false,
  }
}

/**
 * Get embedded asset by path
 */
export function getAsset(path: string): EmbeddedAsset | null {
  // Normalize path
  const normalized = path.startsWith('/') ? path : '/' + path
  return assets[normalized] || null
}

/**
 * Get embedded asset content as Buffer
 */
export function getAssetBuffer(path: string): Buffer | null {
  const asset = getAsset(path)
  if (!asset) return null

  if (asset.isBase64) {
    return Buffer.from(asset.content, 'base64')
  }
  return Buffer.from(asset.content, 'utf-8')
}

/**
 * Get embedded asset content as string
 */
export function getAssetString(path: string): string | null {
  const asset = getAsset(path)
  if (!asset) return null

  if (asset.isBase64) {
    return Buffer.from(asset.content, 'base64').toString('utf-8')
  }
  return asset.content
}

/**
 * Get all template files
 * In compiled mode, include() paths are prefixed with @ to use cache lookup
 */
export function getTemplates(): Record<string, string> {
  const templates: Record<string, string> = {}

  for (const [path, asset] of Object.entries(assets)) {
    if (path.startsWith('/templates/') && path.endsWith('.eta')) {
      const name = path.replace('/templates/', '').replace('.eta', '')
      // Pre-process template: add @ prefix to include() calls
      // This tells Eta to look up from cache instead of resolving file paths
      let content = asset.content
      content = content.replace(/include\s*\(\s*['"](?!@)/g, "include('@")
      templates['@' + name] = content
    }
  }

  return templates
}

/**
 * Get all public files for static serving
 */
export function getPublicFiles(): Map<string, { content: Buffer; mimeType: string }> {
  const files = new Map<string, { content: Buffer; mimeType: string }>()

  for (const [path, asset] of Object.entries(assets)) {
    if (path.startsWith('/public/')) {
      const servePath = path.replace('/public', '')
      const content = asset.isBase64
        ? Buffer.from(asset.content, 'base64')
        : Buffer.from(asset.content, 'utf-8')
      files.set(servePath, { content, mimeType: asset.mimeType })
    }
  }

  return files
}
